<!DOCTYPE html>
<html lang="fr" xml:lang="fr">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5.2 Construction d’un réseau avec R5R | Notes de cours GMQ405 : Modélisation et analyse spatiale</title>
  <meta name="description" content="Mettre le description du cours." />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="5.2 Construction d’un réseau avec R5R | Notes de cours GMQ405 : Modélisation et analyse spatiale" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/introduction/ImageCouverture.png" />
  <meta property="og:description" content="Mettre le description du cours." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.2 Construction d’un réseau avec R5R | Notes de cours GMQ405 : Modélisation et analyse spatiale" />
  
  <meta name="twitter:description" content="Mettre le description du cours." />
  <meta name="twitter:image" content="/images/introduction/ImageCouverture.png" />

<meta name="author" content="Philippe Apparicio, département de géomatique appliquée, Université de Sherbrooke" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sect051.html"/>
<link rel="next" href="sect053.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/quizlib.min.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">GMQ405 : modélisation et analyse spatiale</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Bienvenue</a></li>
<li class="chapter" data-level="" data-path="préface.html"><a href="préface.html"><i class="fa fa-check"></i>Préface</a>
<ul>
<li class="chapter" data-level="" data-path="sect001.html"><a href="sect001.html"><i class="fa fa-check"></i>Un manuel sous la forme d’une ressource éducative libre</a></li>
<li class="chapter" data-level="" data-path="sect002.html"><a href="sect002.html"><i class="fa fa-check"></i>Comment lire ce manuel?</a></li>
<li class="chapter" data-level="" data-path="sect003.html"><a href="sect003.html"><i class="fa fa-check"></i>Comment utiliser les données du livre pour reproduire les exemples?</a></li>
<li class="chapter" data-level="" data-path="sect004.html"><a href="sect004.html"><i class="fa fa-check"></i>Structure du livre</a></li>
<li class="chapter" data-level="" data-path="sect005.html"><a href="sect005.html"><i class="fa fa-check"></i>Pourquoi faut-il programmer en géomatique appliquée et utiliser R?</a></li>
<li class="chapter" data-level="" data-path="sect006.html"><a href="sect006.html"><i class="fa fa-check"></i>Remerciements</a></li>
</ul></li>
<li class="part"><span><b>I Découverte de R</b></span></li>
<li class="chapter" data-level="1" data-path="chap01.html"><a href="chap01.html"><i class="fa fa-check"></i><b>1</b> Manipulation des données spatiales dans R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="sect011.html"><a href="sect011.html"><i class="fa fa-check"></i><b>1.1</b> Importation de données géographiques</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="sect011.html"><a href="sect011.html#sect0111"><i class="fa fa-check"></i><b>1.1.1</b> Importation de données vectorielles</a></li>
<li class="chapter" data-level="1.1.2" data-path="sect011.html"><a href="sect011.html#sect0112"><i class="fa fa-check"></i><b>1.1.2</b> Importation de données <em>raster</em></a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="sect012.html"><a href="sect012.html"><i class="fa fa-check"></i><b>1.2</b> Manipulation de données vectorielles</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="sect012.html"><a href="sect012.html#sect0121"><i class="fa fa-check"></i><b>1.2.1</b> Fonctions relatives à la projection cartographique</a></li>
<li class="chapter" data-level="1.2.2" data-path="sect012.html"><a href="sect012.html#sect0122"><i class="fa fa-check"></i><b>1.2.2</b> Fonctions d’opérations géométriques sur une couche</a></li>
<li class="chapter" data-level="1.2.3" data-path="sect012.html"><a href="sect012.html#sect01213"><i class="fa fa-check"></i><b>1.2.3</b> Fonctions d’opérations géométriques entre deux couches</a></li>
<li class="chapter" data-level="1.2.4" data-path="sect012.html"><a href="sect012.html#sect0124"><i class="fa fa-check"></i><b>1.2.4</b> Fonctions de mesures géométriques et de récupération des coordonnées géographiques</a></li>
<li class="chapter" data-level="1.2.5" data-path="sect012.html"><a href="sect012.html#sect0125"><i class="fa fa-check"></i><b>1.2.5</b> Jointures spatiales</a></li>
<li class="chapter" data-level="1.2.6" data-path="sect012.html"><a href="sect012.html#sect0126"><i class="fa fa-check"></i><b>1.2.6</b> Requêtes spatiales</a></li>
<li class="chapter" data-level="1.2.7" data-path="sect012.html"><a href="sect012.html#sect0127"><i class="fa fa-check"></i><b>1.2.7</b> Manipulation des données attributaires</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="sect013.html"><a href="sect013.html"><i class="fa fa-check"></i><b>1.3</b> Manipulation de données matricielles (<em>raster</em>)</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="sect013.html"><a href="sect013.html#sect0131"><i class="fa fa-check"></i><b>1.3.1</b> Mosaïquage et découpage d’images</a></li>
<li class="chapter" data-level="1.3.2" data-path="sect013.html"><a href="sect013.html#sect0132"><i class="fa fa-check"></i><b>1.3.2</b> Requêtes attributaires sur des images</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="sect014.html"><a href="sect014.html"><i class="fa fa-check"></i><b>1.4</b> Exportation de données spatiales de R vers des formats géographiques</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="sect014.html"><a href="sect014.html#sect0141"><i class="fa fa-check"></i><b>1.4.1</b> Exportation de données vectorielles <code>sf</code></a></li>
<li class="chapter" data-level="1.4.2" data-path="sect014.html"><a href="sect014.html#sect0142"><i class="fa fa-check"></i><b>1.4.2</b> Exportation de données <em>raster</em></a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="sect015.html"><a href="sect015.html"><i class="fa fa-check"></i><b>1.5</b> Cartographie avec R</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="sect015.html"><a href="sect015.html#sect0151"><i class="fa fa-check"></i><b>1.5.1</b> Manipulation des couches géométriques</a></li>
<li class="chapter" data-level="1.5.2" data-path="sect015.html"><a href="sect015.html#sect0152"><i class="fa fa-check"></i><b>1.5.2</b> Cartes interactives</a></li>
<li class="chapter" data-level="1.5.3" data-path="sect015.html"><a href="sect015.html#sect0153"><i class="fa fa-check"></i><b>1.5.3</b> Mise en page d’une carte</a></li>
<li class="chapter" data-level="1.5.4" data-path="sect015.html"><a href="sect015.html#sect0154"><i class="fa fa-check"></i><b>1.5.4</b> Exportation d’une carte</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="sect016.html"><a href="sect016.html"><i class="fa fa-check"></i><b>1.6</b> Quiz de révision du chapitre</a></li>
<li class="chapter" data-level="1.7" data-path="sect017.html"><a href="sect017.html"><i class="fa fa-check"></i><b>1.7</b> Exercices de révision</a></li>
</ul></li>
<li class="part"><span><b>II Autocorrélation spatiale</b></span></li>
<li class="chapter" data-level="2" data-path="chap02.html"><a href="chap02.html"><i class="fa fa-check"></i><b>2</b> Autocorrélation spatiale</a>
<ul>
<li class="chapter" data-level="2.1" data-path="sect021.html"><a href="sect021.html"><i class="fa fa-check"></i><b>2.1</b> Notion d’autocorrélation spatiale</a></li>
<li class="chapter" data-level="2.2" data-path="sect022.html"><a href="sect022.html"><i class="fa fa-check"></i><b>2.2</b> Matrices de pondération spatiale</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="sect022.html"><a href="sect022.html#sect0221"><i class="fa fa-check"></i><b>2.2.1</b> Matrices de contiguïté</a></li>
<li class="chapter" data-level="2.2.2" data-path="sect022.html"><a href="sect022.html#sect0222"><i class="fa fa-check"></i><b>2.2.2</b> Matrices de proximité spatiale</a></li>
<li class="chapter" data-level="2.2.3" data-path="sect022.html"><a href="sect022.html#sect0223"><i class="fa fa-check"></i><b>2.2.3</b> Standardisation des matrices de pondération spatiale en ligne</a></li>
<li class="chapter" data-level="2.2.4" data-path="sect022.html"><a href="sect022.html#sect0224"><i class="fa fa-check"></i><b>2.2.4</b> Construction de matrices de pondération spatiale dans R</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="sect023.html"><a href="sect023.html"><i class="fa fa-check"></i><b>2.3</b> Autocorrélation spatiale globale</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="sect023.html"><a href="sect023.html#sect0231"><i class="fa fa-check"></i><b>2.3.1</b> Statistique du <em>I</em> de Moran</a></li>
<li class="chapter" data-level="2.3.2" data-path="sect023.html"><a href="sect023.html#sect0232"><i class="fa fa-check"></i><b>2.3.2</b> Statistiques de comptage de jointure (<em>Join Count Statistics</em>)</a></li>
<li class="chapter" data-level="2.3.3" data-path="sect023.html"><a href="sect023.html#sect0233"><i class="fa fa-check"></i><b>2.3.3</b> Indice de Lee : autocorrélation spatiale dans un contexte bivarié</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="sect024.html"><a href="sect024.html"><i class="fa fa-check"></i><b>2.4</b> Autocorrélation spatiale locale</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="sect024.html"><a href="sect024.html#sect0241"><i class="fa fa-check"></i><b>2.4.1</b> Statistiques locales de Getis et Ord : repérer les points chauds et froids pour une variable continue</a></li>
<li class="chapter" data-level="2.4.2" data-path="sect024.html"><a href="sect024.html#sect0242"><i class="fa fa-check"></i><b>2.4.2</b> Version locale du <em>I</em> de Moran</a></li>
<li class="chapter" data-level="2.4.3" data-path="sect024.html"><a href="sect024.html#sect0243"><i class="fa fa-check"></i><b>2.4.3</b> Typologie basée sur le diagramme de Moran</a></li>
<li class="chapter" data-level="2.4.4" data-path="sect024.html"><a href="sect024.html#sect0244"><i class="fa fa-check"></i><b>2.4.4</b> Version locale des statistiques de comptage de jointure (<em>Join Count Statistics</em>)</a></li>
<li class="chapter" data-level="2.4.5" data-path="sect024.html"><a href="sect024.html#sect0245"><i class="fa fa-check"></i><b>2.4.5</b> Version locale de l’indice de Lee</a></li>
<li class="chapter" data-level="2.4.6" data-path="sect024.html"><a href="sect024.html#sect0246"><i class="fa fa-check"></i><b>2.4.6</b> Typologie basée sur le diagramme de Moran dans un contexte bivarié</a></li>
<li class="chapter" data-level="2.4.7" data-path="sect024.html"><a href="sect024.html#sect0247"><i class="fa fa-check"></i><b>2.4.7</b> Autocorrélation locale pour une variable qualitative (catégorielle) : l’indicateur ELSA</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="sect025.html"><a href="sect025.html"><i class="fa fa-check"></i><b>2.5</b> Quiz de révision du chapitre</a></li>
<li class="chapter" data-level="2.6" data-path="sect026.html"><a href="sect026.html"><i class="fa fa-check"></i><b>2.6</b> Exercices de révision</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chap03.html"><a href="chap03.html"><i class="fa fa-check"></i><b>3</b> Méthodes de répartition ponctuelle</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sect031.html"><a href="sect031.html"><i class="fa fa-check"></i><b>3.1</b> Fréquence et densité des points dans l’espace d’étude</a></li>
<li class="chapter" data-level="3.2" data-path="sect032.html"><a href="sect032.html"><i class="fa fa-check"></i><b>3.2</b> Analyse centrographique</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sect032.html"><a href="sect032.html#sect0311"><i class="fa fa-check"></i><b>3.2.1</b> Paramètres de tendance centrale d’un semis de points</a></li>
<li class="chapter" data-level="3.2.2" data-path="sect032.html"><a href="sect032.html#sect0312"><i class="fa fa-check"></i><b>3.2.2</b> Paramètres de dispersion d’un semis de points</a></li>
<li class="chapter" data-level="3.2.3" data-path="sect032.html"><a href="sect032.html#sect0313"><i class="fa fa-check"></i><b>3.2.3</b> Mise en œuvre de l’analyse centrographique dans R</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sect033.html"><a href="sect033.html"><i class="fa fa-check"></i><b>3.3</b> Forme d’un semis de points</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sect033.html"><a href="sect033.html#sect0331"><i class="fa fa-check"></i><b>3.3.1</b> Méthode du plus proche voisin</a></li>
<li class="chapter" data-level="3.3.2" data-path="sect033.html"><a href="sect033.html#sect0332"><i class="fa fa-check"></i><b>3.3.2</b> Méthode des quadrats</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sect034.html"><a href="sect034.html"><i class="fa fa-check"></i><b>3.4</b> Identification des agrégats spatiaux</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="sect034.html"><a href="sect034.html#sect0341"><i class="fa fa-check"></i><b>3.4.1</b> Cartographie de la densité dans une maille irrégulière</a></li>
<li class="chapter" data-level="3.4.2" data-path="sect034.html"><a href="sect034.html#sect0342"><i class="fa fa-check"></i><b>3.4.2</b> Cartographie de la densité dans une maille régulière</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="sect035.html"><a href="sect035.html"><i class="fa fa-check"></i><b>3.5</b> Quiz de révision du chapitre</a></li>
<li class="chapter" data-level="3.6" data-path="sect036.html"><a href="sect036.html"><i class="fa fa-check"></i><b>3.6</b> Exercices de révision</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chap04.html"><a href="chap04.html"><i class="fa fa-check"></i><b>4</b> Méthodes de détection d’agrégats spatiaux et spatio-temporels</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sect041.html"><a href="sect041.html"><i class="fa fa-check"></i><b>4.1</b> Agrégats d’entités spatiales ponctuelles</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="sect041.html"><a href="sect041.html#sect0411"><i class="fa fa-check"></i><b>4.1.1</b> DBSCAN : agrégats spatiaux</a></li>
<li class="chapter" data-level="4.1.2" data-path="sect041.html"><a href="sect041.html#sect0412"><i class="fa fa-check"></i><b>4.1.2</b> ST-DBSCAN : agrégats spatio-temporels</a></li>
<li class="chapter" data-level="4.1.3" data-path="sect041.html"><a href="sect041.html#sect0414"><i class="fa fa-check"></i><b>4.1.3</b> Mise en œuvre dans R</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="sect042.html"><a href="sect042.html"><i class="fa fa-check"></i><b>4.2</b> Méthodes de balayage de Kulldorff</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="sect042.html"><a href="sect042.html#sect0421"><i class="fa fa-check"></i><b>4.2.1</b> Objectifs de la méthode, types d’analyses, de modèles et d’agrégats</a></li>
<li class="chapter" data-level="4.2.2" data-path="sect042.html"><a href="sect042.html#sect0422"><i class="fa fa-check"></i><b>4.2.2</b> Principes de base de la méthode</a></li>
<li class="chapter" data-level="4.2.3" data-path="sect042.html"><a href="sect042.html#sect043"><i class="fa fa-check"></i><b>4.2.3</b> Mise en oeuvre dans R</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="sect044.html"><a href="sect044.html"><i class="fa fa-check"></i><b>4.3</b> Quiz de révision du chapitre</a></li>
<li class="chapter" data-level="4.4" data-path="sect045.html"><a href="sect045.html"><i class="fa fa-check"></i><b>4.4</b> Exercices de révision</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chap05.html"><a href="chap05.html"><i class="fa fa-check"></i><b>5</b> Mesures d’accessibilité spatiale selon les différents de modes de transport</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sect051.html"><a href="sect051.html"><i class="fa fa-check"></i><b>5.1</b> Notions relatives à l’analyse de réseau</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="sect051.html"><a href="sect051.html#sect0511"><i class="fa fa-check"></i><b>5.1.1</b> Définition d’un réseau</a></li>
<li class="chapter" data-level="5.1.2" data-path="sect051.html"><a href="sect051.html#sect0512"><i class="fa fa-check"></i><b>5.1.2</b> Principaux problèmes résolus en analyse de réseau</a></li>
<li class="chapter" data-level="5.1.3" data-path="sect051.html"><a href="sect051.html#sect0513"><i class="fa fa-check"></i><b>5.1.3</b> Analyse de réseau et entités polygonales</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="sect052.html"><a href="sect052.html"><i class="fa fa-check"></i><b>5.2</b> Construction d’un réseau avec R5R</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="sect052.html"><a href="sect052.html#sect0521"><i class="fa fa-check"></i><b>5.2.1</b> Extraction des données spatiales pour R5R</a></li>
<li class="chapter" data-level="5.2.2" data-path="sect052.html"><a href="sect052.html#sect0522"><i class="fa fa-check"></i><b>5.2.2</b> Construction du réseau avec R5R</a></li>
<li class="chapter" data-level="5.2.3" data-path="sect052.html"><a href="sect052.html#sect0523"><i class="fa fa-check"></i><b>5.2.3</b> Calcul d’itinéraires avec R5R selon le mode de transport</a></li>
<li class="chapter" data-level="5.2.4" data-path="sect052.html"><a href="sect052.html#sect0524"><i class="fa fa-check"></i><b>5.2.4</b> Calcul de matrices OD selon différents modes de transport</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="sect053.html"><a href="sect053.html"><i class="fa fa-check"></i><b>5.3</b> Mesures d’accessibilité</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="sect053.html"><a href="sect053.html#sect0531"><i class="fa fa-check"></i><b>5.3.1</b> Notion d’accessibilité</a></li>
<li class="chapter" data-level="5.3.2" data-path="sect053.html"><a href="sect053.html#sect0532"><i class="fa fa-check"></i><b>5.3.2</b> Accessibilité spatiale potentielle</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="sect054.html"><a href="sect054.html"><i class="fa fa-check"></i><b>5.4</b> Mesures d’accessibilité spatiale potentielle dans R</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="sect054.html"><a href="sect054.html#sect0541"><i class="fa fa-check"></i><b>5.4.1</b> Accessibilité spatiale potentielle aux supermarchés</a></li>
<li class="chapter" data-level="5.4.2" data-path="sect054.html"><a href="sect054.html#sect0542"><i class="fa fa-check"></i><b>5.4.2</b> Accessibilité spatiale potentielle aux patinoires extérieures</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="sect055.html"><a href="sect055.html"><i class="fa fa-check"></i><b>5.5</b> Quiz de révision du chapitre</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chap06.html"><a href="chap06.html"><i class="fa fa-check"></i><b>6</b> Analyses d’évènements localisés sur un réseau</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sect061.html"><a href="sect061.html"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="sect062.html"><a href="sect062.html"><i class="fa fa-check"></i><b>6.2</b> Cartographie de la densité d’évènements sur un réseau</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="sect062.html"><a href="sect062.html#sect0621"><i class="fa fa-check"></i><b>6.2.1</b> Explication du NKDE et du TNKDE</a></li>
<li class="chapter" data-level="6.2.2" data-path="sect062.html"><a href="sect062.html#sect0622"><i class="fa fa-check"></i><b>6.2.2</b> Mise en œuvre dans R</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="sect063.html"><a href="sect063.html"><i class="fa fa-check"></i><b>6.3</b> Mesure d’autocorrélation spatiale sur un réseau</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="sect063.html"><a href="sect063.html#sect0631"><i class="fa fa-check"></i><b>6.3.1</b> Getis et Ord</a></li>
<li class="chapter" data-level="6.3.2" data-path="sect063.html"><a href="sect063.html#sect0632"><i class="fa fa-check"></i><b>6.3.2</b> Typologie basée sur le diagramme de Moran</a></li>
<li class="chapter" data-level="6.3.3" data-path="sect063.html"><a href="sect063.html#sect0633"><i class="fa fa-check"></i><b>6.3.3</b> Mise en œuvre dans R</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="sect064.html"><a href="sect064.html"><i class="fa fa-check"></i><b>6.4</b> DBSCAN sur un réseau</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="sect064.html"><a href="sect064.html#sect0641"><i class="fa fa-check"></i><b>6.4.1</b> Explication du NKDE et du TNKDE</a></li>
<li class="chapter" data-level="6.4.2" data-path="sect064.html"><a href="sect064.html#sect0642"><i class="fa fa-check"></i><b>6.4.2</b> Mise en œuvre dans R</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="sect065.html"><a href="sect065.html"><i class="fa fa-check"></i><b>6.5</b> Quiz de révision du chapitre</a></li>
<li class="chapter" data-level="6.6" data-path="sect066.html"><a href="sect066.html"><i class="fa fa-check"></i><b>6.6</b> Exercices de révision</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chap07.html"><a href="chap07.html"><i class="fa fa-check"></i><b>7</b> Introduction aux modèles de régression spatiale</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sect071.html"><a href="sect071.html"><i class="fa fa-check"></i><b>7.1</b> Modèles économétriques spatiaux</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="sect071.html"><a href="sect071.html#sect0711"><i class="fa fa-check"></i><b>7.1.1</b> Bref retour sur la régression linéaire multiple</a></li>
<li class="chapter" data-level="7.1.2" data-path="sect071.html"><a href="sect071.html#sect0712"><i class="fa fa-check"></i><b>7.1.2</b> Les différents modèles spatiaux autorégressifs</a></li>
<li class="chapter" data-level="7.1.3" data-path="sect071.html"><a href="sect071.html#sect0713"><i class="fa fa-check"></i><b>7.1.3</b> Quel modèle choisir?</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="sect072.html"><a href="sect072.html"><i class="fa fa-check"></i><b>7.2</b> Modèles généralisés additifs (GAM) avec une <em>spline</em> bivariée sur les coordonnées géographiques</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="sect072.html"><a href="sect072.html#sect0721"><i class="fa fa-check"></i><b>7.2.1</b> Principe de base d’un GAM intégrant l’espace</a></li>
<li class="chapter" data-level="7.2.2" data-path="sect072.html"><a href="sect072.html#sect0722"><i class="fa fa-check"></i><b>7.2.2</b> Construction d’un modèle GAM dans R</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="sect073.html"><a href="sect073.html"><i class="fa fa-check"></i><b>7.3</b> Régression géographiquement pondérée</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="sect073.html"><a href="sect073.html#sect0731"><i class="fa fa-check"></i><b>7.3.1</b> Principe de base</a></li>
<li class="chapter" data-level="7.3.2" data-path="sect073.html"><a href="sect073.html#sect0732"><i class="fa fa-check"></i><b>7.3.2</b> Construction et analyse du modèle GWR dans R</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="sect074.html"><a href="sect074.html"><i class="fa fa-check"></i><b>7.4</b> Quiz de révision du chapitre</a></li>
<li class="chapter" data-level="7.5" data-path="sect075.html"><a href="sect075.html"><i class="fa fa-check"></i><b>7.5</b> Exercices de révision</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chap08.html"><a href="chap08.html"><i class="fa fa-check"></i><b>8</b> Méthodes de classification non supervisée spatiale</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sect081.html"><a href="sect081.html"><i class="fa fa-check"></i><b>8.1</b> Méthodes de classification non supervisée avec contrainte spatiale</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="sect081.html"><a href="sect081.html#sect0811"><i class="fa fa-check"></i><b>8.1.1</b> Algorithmes AZP</a></li>
<li class="chapter" data-level="8.1.2" data-path="sect081.html"><a href="sect081.html#sect0812"><i class="fa fa-check"></i><b>8.1.2</b> Algorithme SKATER</a></li>
<li class="chapter" data-level="8.1.3" data-path="sect081.html"><a href="sect081.html#sect0813"><i class="fa fa-check"></i><b>8.1.3</b> Algorithmes REDCAP</a></li>
<li class="chapter" data-level="8.1.4" data-path="sect081.html"><a href="sect081.html#sect0814"><i class="fa fa-check"></i><b>8.1.4</b> Algorithme du <em>max-p-regions problem</em></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="sect082.html"><a href="sect082.html"><i class="fa fa-check"></i><b>8.2</b> Méthodes de classification non supervisée avec une dimension spatiale</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="sect082.html"><a href="sect082.html#sect0821"><i class="fa fa-check"></i><b>8.2.1</b> Classification ascendante hiérarchique spatiale (<em>ClustGeo</em>)</a></li>
<li class="chapter" data-level="8.2.2" data-path="sect082.html"><a href="sect082.html#sect0822"><i class="fa fa-check"></i><b>8.2.2</b> <em>Spatial fuzzy c-means</em></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="sect083.html"><a href="sect083.html"><i class="fa fa-check"></i><b>8.3</b> Quiz de révision du chapitre</a></li>
<li class="chapter" data-level="8.4" data-path="sect084.html"><a href="sect084.html"><i class="fa fa-check"></i><b>8.4</b> Exercices de révision</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chap09.html"><a href="chap09.html"><i class="fa fa-check"></i><b>9</b> Méthodes d’interpolation spatiale</a>
<ul>
<li class="chapter" data-level="9.1" data-path="sect091.html"><a href="sect091.html"><i class="fa fa-check"></i><b>9.1</b> Méthodes déterministes</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="sect091.html"><a href="sect091.html#sect0911"><i class="fa fa-check"></i><b>9.1.1</b> Interpolation polynomiale locale</a></li>
<li class="chapter" data-level="9.1.2" data-path="sect091.html"><a href="sect091.html#sect0912"><i class="fa fa-check"></i><b>9.1.2</b> Interpolation de l’inverse à la distance (<em>IDW</em>)</a></li>
<li class="chapter" data-level="9.1.3" data-path="sect091.html"><a href="sect091.html#sect0913"><i class="fa fa-check"></i><b>9.1.3</b> Fonctions relationnelles</a></li>
<li class="chapter" data-level="9.1.4" data-path="sect091.html"><a href="sect091.html#sect0914"><i class="fa fa-check"></i><b>9.1.4</b> Fonctions conditionnelles</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="sect092.html"><a href="sect092.html"><i class="fa fa-check"></i><b>9.2</b> Méthodes géostatistiques</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="sect092.html"><a href="sect092.html#sect0921"><i class="fa fa-check"></i><b>9.2.1</b> Krigeage simple</a></li>
<li class="chapter" data-level="9.2.2" data-path="sect092.html"><a href="sect092.html#sect0922"><i class="fa fa-check"></i><b>9.2.2</b> Krigeage universel</a></li>
<li class="chapter" data-level="9.2.3" data-path="sect092.html"><a href="sect092.html#sect0923"><i class="fa fa-check"></i><b>9.2.3</b> Co-krigeage</a></li>
<li class="chapter" data-level="9.2.4" data-path="sect092.html"><a href="sect092.html#sect0924"><i class="fa fa-check"></i><b>9.2.4</b> Krigeage résiduel</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="sect093.html"><a href="sect093.html"><i class="fa fa-check"></i><b>9.3</b> Quiz de révision du chapitre</a></li>
<li class="chapter" data-level="9.4" data-path="sect094.html"><a href="sect094.html"><i class="fa fa-check"></i><b>9.4</b> Exercices de révision</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chap10.html"><a href="chap10.html"><i class="fa fa-check"></i><b>10</b> Correction des exercices</a>
<ul>
<li class="chapter" data-level="10.1" data-path="sect1001.html"><a href="sect1001.html"><i class="fa fa-check"></i><b>10.1</b> Exercices du chapitre 1</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="sect1001.html"><a href="sect1001.html#sect10011"><i class="fa fa-check"></i><b>10.1.1</b> Exercice 1</a></li>
<li class="chapter" data-level="10.1.2" data-path="sect1001.html"><a href="sect1001.html#sect10012"><i class="fa fa-check"></i><b>10.1.2</b> Exercice 2</a></li>
<li class="chapter" data-level="10.1.3" data-path="sect1001.html"><a href="sect1001.html#sect10013"><i class="fa fa-check"></i><b>10.1.3</b> Exercice 3</a></li>
<li class="chapter" data-level="10.1.4" data-path="sect1001.html"><a href="sect1001.html#sect10014"><i class="fa fa-check"></i><b>10.1.4</b> Exercice 4</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="sect1002.html"><a href="sect1002.html"><i class="fa fa-check"></i><b>10.2</b> Exercices du chapitre 2</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="sect1002.html"><a href="sect1002.html#sect10021"><i class="fa fa-check"></i><b>10.2.1</b> Exercice 1</a></li>
<li class="chapter" data-level="10.2.2" data-path="sect1002.html"><a href="sect1002.html#sect10022"><i class="fa fa-check"></i><b>10.2.2</b> Exercice 2</a></li>
<li class="chapter" data-level="10.2.3" data-path="sect1002.html"><a href="sect1002.html#sect10023"><i class="fa fa-check"></i><b>10.2.3</b> Exercice 3</a></li>
<li class="chapter" data-level="10.2.4" data-path="sect1002.html"><a href="sect1002.html#sect10024"><i class="fa fa-check"></i><b>10.2.4</b> Exercice 4</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="sect1003.html"><a href="sect1003.html"><i class="fa fa-check"></i><b>10.3</b> Exercices du chapitre 3</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="sect1003.html"><a href="sect1003.html#sect10031"><i class="fa fa-check"></i><b>10.3.1</b> Exercice 1</a></li>
<li class="chapter" data-level="10.3.2" data-path="sect1003.html"><a href="sect1003.html#sect10032"><i class="fa fa-check"></i><b>10.3.2</b> Exercice 2</a></li>
<li class="chapter" data-level="10.3.3" data-path="sect1003.html"><a href="sect1003.html#sect10033"><i class="fa fa-check"></i><b>10.3.3</b> Exercice 3</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="sect1004.html"><a href="sect1004.html"><i class="fa fa-check"></i><b>10.4</b> Exercices du chapitre 4</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="sect1004.html"><a href="sect1004.html#sect10041"><i class="fa fa-check"></i><b>10.4.1</b> Exercice 1</a></li>
<li class="chapter" data-level="10.4.2" data-path="sect1004.html"><a href="sect1004.html#sect10042"><i class="fa fa-check"></i><b>10.4.2</b> Exercice 2</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="sect1005.html"><a href="sect1005.html"><i class="fa fa-check"></i><b>10.5</b> Exercices du chapitre 5</a></li>
<li class="chapter" data-level="10.6" data-path="sect1006.html"><a href="sect1006.html"><i class="fa fa-check"></i><b>10.6</b> Exercices du chapitre 6</a></li>
<li class="chapter" data-level="10.7" data-path="sect1007.html"><a href="sect1007.html"><i class="fa fa-check"></i><b>10.7</b> Exercices du chapitre 7</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="sect1007.html"><a href="sect1007.html#sect10071"><i class="fa fa-check"></i><b>10.7.1</b> Exercice 1</a></li>
<li class="chapter" data-level="10.7.2" data-path="sect1007.html"><a href="sect1007.html#sect10072"><i class="fa fa-check"></i><b>10.7.2</b> Exercice 2</a></li>
<li class="chapter" data-level="10.7.3" data-path="sect1007.html"><a href="sect1007.html#sect10073"><i class="fa fa-check"></i><b>10.7.3</b> Exercice 3</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="sect1008.html"><a href="sect1008.html"><i class="fa fa-check"></i><b>10.8</b> Exercices du chapitre 8</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="sect1008.html"><a href="sect1008.html#sect10081"><i class="fa fa-check"></i><b>10.8.1</b> Exercice 1</a></li>
</ul></li>
<li class="chapter" data-level="10.9" data-path="sect1009.html"><a href="sect1009.html"><i class="fa fa-check"></i><b>10.9</b> Exercices du chapitre 9</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes de cours GMQ405 :
Modélisation et analyse spatiale</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sect052" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Construction d’un réseau avec R5R<a href="sect052.html#sect052" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Pour construire un réseau pour différents modes de transport dans R, nous utilisons le <em>package</em> <code>R5R</code> <span class="citation">(<a href="#ref-packageR5R">Pereira et al. 2021</a>)</span>. Il existe d’autres <em>packages</em>, notamment <code>opentripplanner</code> <span class="citation">(<a href="#ref-packageOpenTripPlanner">Morgan et al. 2019</a>)</span> qui a été largement utilisé ces dernières années. Étant plus rapide, <code>R5R</code> s’impose actuellement comme la solution la plus efficace pour calculer des trajets à travers un réseau de rues selon différents modes de transport.</p>
<div class="bloc_notes">
<p><strong>Documentation du <em>package</em> <code>R5R</code></strong></p>
<p>Nous vous conseillons vivement de lire la documentation de <code>R5R</code> sur <a href="https://cran.r-project.org/web/packages/r5r/index.html">le site de CRAN</a>, notamment les nombreuses vignettes présentant des exemples d’analyses avec du code R très bien documenté.</p>
</div>
<div id="sect0521" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Extraction des données spatiales pour R5R<a href="sect052.html#sect0521" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pour construire un réseau multimode, <code>R5R</code> a besoin de trois fichiers qui doivent être localisés dans le même dossier (figure <a href="sect052.html#fig:DonneesReseauR5R">5.6</a>) :</p>
<ol style="list-style-type: decimal">
<li>un fichier <em>pbf</em> (<em>Protocolbuffer Binary Format</em>) pour les données d’OpenStreetMap.</li>
<li>un ou plusieurs fichiers <em>GTFS</em> (<em>General Transit Feed Specification</em>) pour les flux relatifs aux transports en commun.</li>
<li>un fichier <em>GeoTIFF</em> d’élévation.</li>
</ol>
<p>Notez que ce dernier fichier est optionnel. Toutefois, pour calculer des trajets à pied ou à vélo, il est préférable de tenir compte de la pente, surtout dans une ville comme Sherbrooke!</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:DonneesReseauR5R"></span>
<img src="images/Chap05/DonneesPourR5R.png" alt="Trois types de données nécessaires pour modéliser un réseau dans R5R" width="70%" />
<p class="caption">
Figure 5.6: Trois types de données nécessaires pour modéliser un réseau dans R5R
</p>
</div>
<div id="sect05212" class="section level4 hasAnchor" number="5.2.1.1">
<h4><span class="header-section-number">5.2.1.1</span> Extraction d’un fichier OpenStreetMap<a href="sect052.html#sect05212" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Pour récupérer un fichier OpenStreetMap (OSM, format <em>pbf</em>), nous utilisons deux fonctions du <em>package</em> <code>osmextract</code> <span class="citation">(<a href="#ref-osmextractpackage">Gilardi et Lovelace 2022</a>)</span> :</p>
<ul>
<li><code>oe_match</code> pour repérer le fichier OSM pour la région de l’Estrie.</li>
<li><code>oe_download</code> pour télécharger le fichier OSM pour la région de l’Estrie.</li>
</ul>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="sect052.html#cb385-1" tabindex="-1"></a><span class="fu">library</span>(osmextract)</span>
<span id="cb385-2"><a href="sect052.html#cb385-2" tabindex="-1"></a><span class="do">## Identification du fichier OSM (format pbf) pour l&#39;Estrie</span></span>
<span id="cb385-3"><a href="sect052.html#cb385-3" tabindex="-1"></a>Estrie <span class="ot">=</span> <span class="fu">oe_match</span>(<span class="at">place=</span><span class="st">&quot;Estrie&quot;</span>, <span class="at">provider =</span> <span class="st">&quot;openstreetmap_fr&quot;</span>)</span>
<span id="cb385-4"><a href="sect052.html#cb385-4" tabindex="-1"></a><span class="do">## Téléchargement du fichier OSM (format pbf) pour l&#39;Estrie</span></span>
<span id="cb385-5"><a href="sect052.html#cb385-5" tabindex="-1"></a><span class="fu">oe_download</span>(</span>
<span id="cb385-6"><a href="sect052.html#cb385-6" tabindex="-1"></a>  <span class="at">file_url =</span> Estrie<span class="sc">$</span>url,</span>
<span id="cb385-7"><a href="sect052.html#cb385-7" tabindex="-1"></a>  <span class="at">file_size =</span> Estrie<span class="sc">$</span>file_size,</span>
<span id="cb385-8"><a href="sect052.html#cb385-8" tabindex="-1"></a>  <span class="at">provider =</span> <span class="st">&quot;openstreetmap_fr&quot;</span>,</span>
<span id="cb385-9"><a href="sect052.html#cb385-9" tabindex="-1"></a>  <span class="at">download_directory =</span> <span class="st">&quot;data/chap05/__TempOSM&quot;</span>)</span></code></pre></div>
<p>Le fichier OSM téléchargé plus haut couvre la région de l’Estrie. À notre connaissance, il n’existe pas de solution pour découper un fichier <em>pbf</em> dans R. Par conséquent, nous récupérons les coordonnées minimales et maximales de l’enveloppe d’une zone tampon de 5000 mètres autour de la couche de la ville de Sherbrooke. Puis, pour découper le fichier <em>pbf</em>, nous utilisons l’outil <a href="https://wiki.openstreetmap.org/wiki/Osmconvert"><strong>osmconvert64-0.8.8p.exe</strong></a>. Le code ci-dessous renvoie les quatre coordonnées de l’enveloppe.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="sect052.html#cb386-1" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb386-2"><a href="sect052.html#cb386-2" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb386-3"><a href="sect052.html#cb386-3" tabindex="-1"></a><span class="do">## Importation du polygone pour la ville de Sherbrooke avec sf</span></span>
<span id="cb386-4"><a href="sect052.html#cb386-4" tabindex="-1"></a>Sherbrooke <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">&quot;data/chap05/AutresDonnees/Sherbrooke.shp&quot;</span>, <span class="at">quiet=</span><span class="cn">TRUE</span>)</span>
<span id="cb386-5"><a href="sect052.html#cb386-5" tabindex="-1"></a><span class="do">## Création d&#39;une zone tampon de 5 km</span></span>
<span id="cb386-6"><a href="sect052.html#cb386-6" tabindex="-1"></a>zone <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(Sherbrooke, <span class="at">dist =</span> <span class="dv">5000</span>)</span>
<span id="cb386-7"><a href="sect052.html#cb386-7" tabindex="-1"></a><span class="do">## Changement de la projection en 4326</span></span>
<span id="cb386-8"><a href="sect052.html#cb386-8" tabindex="-1"></a>zone <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(zone, <span class="dv">4326</span>)</span>
<span id="cb386-9"><a href="sect052.html#cb386-9" tabindex="-1"></a><span class="do">## Création de l&#39;enveloppe autour de la couche</span></span>
<span id="cb386-10"><a href="sect052.html#cb386-10" tabindex="-1"></a>enveloppe <span class="ot">=</span> <span class="fu">st_bbox</span>(zone)</span>
<span id="cb386-11"><a href="sect052.html#cb386-11" tabindex="-1"></a><span class="do">## Visualisation des coordonnées minimales et maximales</span></span>
<span id="cb386-12"><a href="sect052.html#cb386-12" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">&quot;Minimum longitude : &quot;</span>, <span class="fu">round</span>(enveloppe[<span class="dv">1</span>],<span class="dv">4</span>),</span>
<span id="cb386-13"><a href="sect052.html#cb386-13" tabindex="-1"></a>           <span class="st">&quot;</span><span class="sc">\n</span><span class="st"> Minimum latitude : &quot;</span>, <span class="fu">round</span>(enveloppe[<span class="dv">2</span>],<span class="dv">4</span>),</span>
<span id="cb386-14"><a href="sect052.html#cb386-14" tabindex="-1"></a>           <span class="st">&quot;</span><span class="sc">\n</span><span class="st"> Maximum longitude : &quot;</span>, <span class="fu">round</span>(enveloppe[<span class="dv">3</span>],<span class="dv">4</span>),</span>
<span id="cb386-15"><a href="sect052.html#cb386-15" tabindex="-1"></a>           <span class="st">&quot;</span><span class="sc">\n</span><span class="st"> Maximum latitude : &quot;</span>, <span class="fu">round</span>(enveloppe[<span class="dv">4</span>],<span class="dv">4</span>)</span>
<span id="cb386-16"><a href="sect052.html#cb386-16" tabindex="-1"></a>    ))</span></code></pre></div>
<pre><code>## Minimum longitude : -72.1537
##  Minimum latitude : 45.2683
##  Maximum longitude : -71.7576
##  Maximum latitude : 45.5554</code></pre>
<p>L’application <strong>Osmconvert</strong> est disponible pour <a href="https://wiki.openstreetmap.org/wiki/Osmconvert#Windows">Windows</a> et <a href="https://wiki.openstreetmap.org/wiki/Osmconvert#Linux">Linux</a>. Pour découper un fichier avec les coordonnées latitude/longitude minimales et maximales avec <strong>Osmconvert</strong>, nous écrivons une commande système et l’exécutons avec la fonction <code>system</code>. Pour utiliser le code ci-dessous, vous devez avoir préalablement téléchargé <strong>Osmconvert</strong> et connaitre son emplacement.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="sect052.html#cb388-1" tabindex="-1"></a><span class="do">## Préparation des chemins</span></span>
<span id="cb388-2"><a href="sect052.html#cb388-2" tabindex="-1"></a>path_to_osm_convert <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">&#39;/data/chap05/__TempOSM/osmconvert64-0.8.8p.exe&#39;</span>)</span>
<span id="cb388-3"><a href="sect052.html#cb388-3" tabindex="-1"></a>path_to_big_osm <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">&#39;/data/chap05/__TempOSM/openstreetmap_fr_estrie-latest.osm.pbf&#39;</span>)</span>
<span id="cb388-4"><a href="sect052.html#cb388-4" tabindex="-1"></a>path_to_small_osm <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">&#39;/data/chap05/__TempOSM/openstreetmap_fr_estrie-latest.osm_01.pbf&#39;</span>)</span>
<span id="cb388-5"><a href="sect052.html#cb388-5" tabindex="-1"></a><span class="do">## Écriture de la commande</span></span>
<span id="cb388-6"><a href="sect052.html#cb388-6" tabindex="-1"></a>commande <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;&quot;&#39;</span>,path_to_osm_convert, <span class="st">&#39;&quot; &quot;&#39;</span>,</span>
<span id="cb388-7"><a href="sect052.html#cb388-7" tabindex="-1"></a>                   path_to_big_osm, <span class="st">&#39;&quot; -b=&#39;</span>,<span class="fu">paste0</span>(enveloppe[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), </span>
<span id="cb388-8"><a href="sect052.html#cb388-8" tabindex="-1"></a>                   <span class="st">&#39; -o=&quot;&#39;</span>,path_to_small_osm,<span class="st">&#39;&quot;&#39;</span>)</span></code></pre></div>
<p>Une fois que la commande est écrite, nous l’exécutons.</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="sect052.html#cb389-1" tabindex="-1"></a><span class="fu">system</span>(commande)</span></code></pre></div>
<p>Notez qu’il est possible d’obtenir le même résultat avec l’application <a href="https://wiki.openstreetmap.org/wiki/Osmosis"><strong>Osmosis</strong></a>. Il s’agit d’un outil rédigé en <strong>Java</strong> et qui dispose de fonctionnalités similaires à celles de <strong>Osmconvert</strong>. Puisqu’il est rédigé en <strong>Java</strong>, il peut être utilisé sur davantage de plateformes qu’<strong>Osmconvert</strong>.</p>
</div>
<div id="sect05213" class="section level4 hasAnchor" number="5.2.1.2">
<h4><span class="header-section-number">5.2.1.2</span> Construction d’un fichier <em>GeoTIFF</em> pour l’élévation<a href="sect052.html#sect05213" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Pour créer un fichier <em>GeoTIFF</em> pour l’élévation, nous utilisons les modèles numériques de terrain (MNT) du <a href="https://www.donneesquebec.ca/recherche/dataset/modeles-numeriques-d-altitude-a-l-echelle-de-1-20-000">ministère des Ressources naturelles et des Forêts</a>.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="sect052.html#cb390-1" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb390-2"><a href="sect052.html#cb390-2" tabindex="-1"></a><span class="do">## Couche polygonale sf pour la ville de Sherbrooke</span></span>
<span id="cb390-3"><a href="sect052.html#cb390-3" tabindex="-1"></a><span class="co"># Shapefile pour les régions du Québec au 1/20000</span></span>
<span id="cb390-4"><a href="sect052.html#cb390-4" tabindex="-1"></a><span class="co"># https://www.donneesquebec.ca/recherche/dataset/decoupages-administratifs/resource/b368d470-71d6-40a2-8457-e4419de2f9c0</span></span>
<span id="cb390-5"><a href="sect052.html#cb390-5" tabindex="-1"></a>Sherbrooke <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">&quot;data/chap05/AutresDonnees/Sherbrooke.shp&quot;</span>, <span class="at">quiet=</span><span class="cn">TRUE</span>)</span>
<span id="cb390-6"><a href="sect052.html#cb390-6" tabindex="-1"></a>Sherbrooke <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(Sherbrooke, <span class="at">dist =</span> <span class="dv">5000</span>)</span>
<span id="cb390-7"><a href="sect052.html#cb390-7" tabindex="-1"></a><span class="do">## Feuillets pour les MNT au 1/20000</span></span>
<span id="cb390-8"><a href="sect052.html#cb390-8" tabindex="-1"></a><span class="do">## Importation du shapefile des feuillets</span></span>
<span id="cb390-9"><a href="sect052.html#cb390-9" tabindex="-1"></a><span class="do">## (https://www.donneesquebec.ca/recherche/dataset/modeles-numeriques-d-altitude-a-l-echelle-de-1-20-000/resource/2df157af-74cf-4b53-af9d-1d3ccee0d6e1)</span></span>
<span id="cb390-10"><a href="sect052.html#cb390-10" tabindex="-1"></a>Feuillets <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">&quot;data/chap05/AutresDonnees/Index_MNT20k.shp&quot;</span>, <span class="at">quiet=</span><span class="cn">TRUE</span>)</span>
<span id="cb390-11"><a href="sect052.html#cb390-11" tabindex="-1"></a><span class="do">### Nous nous assurons que les deux couches ont la même projection, soit EPSG 4326</span></span>
<span id="cb390-12"><a href="sect052.html#cb390-12" tabindex="-1"></a>Sherbrooke <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(Sherbrooke, <span class="fu">st_crs</span>(Feuillets))</span>
<span id="cb390-13"><a href="sect052.html#cb390-13" tabindex="-1"></a><span class="do">### Sélection des feuillets qui intersectent le polygone de l&#39;Estrie</span></span>
<span id="cb390-14"><a href="sect052.html#cb390-14" tabindex="-1"></a>RequeteSpatiale <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(Feuillets, Sherbrooke, <span class="at">sparse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb390-15"><a href="sect052.html#cb390-15" tabindex="-1"></a>Feuillets<span class="sc">$</span>Intersect <span class="ot">&lt;-</span>  RequeteSpatiale[, <span class="dv">1</span>]</span>
<span id="cb390-16"><a href="sect052.html#cb390-16" tabindex="-1"></a>FeuilletsSherbrooke <span class="ot">&lt;-</span> <span class="fu">subset</span>(Feuillets,Intersect <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb390-17"><a href="sect052.html#cb390-17" tabindex="-1"></a></span>
<span id="cb390-18"><a href="sect052.html#cb390-18" tabindex="-1"></a><span class="do">## Téléchargement des GRIDS</span></span>
<span id="cb390-19"><a href="sect052.html#cb390-19" tabindex="-1"></a><span class="do">### Création d&#39;un dossier temporaire pour les MNT</span></span>
<span id="cb390-20"><a href="sect052.html#cb390-20" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">paste0</span>(<span class="st">&quot;data/chap05/AutresDonnees/MNT&quot;</span>))</span>
<span id="cb390-21"><a href="sect052.html#cb390-21" tabindex="-1"></a>grids <span class="ot">&lt;-</span> FeuilletsSherbrooke<span class="sc">$</span>GRID</span>
<span id="cb390-22"><a href="sect052.html#cb390-22" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb390-23"><a href="sect052.html#cb390-23" tabindex="-1"></a><span class="cf">for</span> (e <span class="cf">in</span> grids) {</span>
<span id="cb390-24"><a href="sect052.html#cb390-24" tabindex="-1"></a>  i <span class="ot">=</span> i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb390-25"><a href="sect052.html#cb390-25" tabindex="-1"></a>  <span class="co"># Téléchargement</span></span>
<span id="cb390-26"><a href="sect052.html#cb390-26" tabindex="-1"></a>  Fichier <span class="ot">&lt;-</span> <span class="fu">substr</span>(e, <span class="dv">88</span>, <span class="fu">nchar</span>(e))</span>
<span id="cb390-27"><a href="sect052.html#cb390-27" tabindex="-1"></a>  Chemin <span class="ot">&lt;-</span>  <span class="st">&quot;data/chap05/AutresDonnees/MNT&quot;</span></span>
<span id="cb390-28"><a href="sect052.html#cb390-28" tabindex="-1"></a>  CheminFichier <span class="ot">&lt;-</span> <span class="fu">paste0</span>(Chemin, <span class="st">&quot;/&quot;</span>, Fichier)</span>
<span id="cb390-29"><a href="sect052.html#cb390-29" tabindex="-1"></a>  <span class="fu">download.file</span>(e, <span class="at">destfile =</span> CheminFichier)</span>
<span id="cb390-30"><a href="sect052.html#cb390-30" tabindex="-1"></a>  <span class="co"># Décompression du fichier zip</span></span>
<span id="cb390-31"><a href="sect052.html#cb390-31" tabindex="-1"></a>  <span class="fu">unzip</span>(CheminFichier, <span class="at">exdir =</span> Chemin)</span>
<span id="cb390-32"><a href="sect052.html#cb390-32" tabindex="-1"></a>}</span>
<span id="cb390-33"><a href="sect052.html#cb390-33" tabindex="-1"></a></span>
<span id="cb390-34"><a href="sect052.html#cb390-34" tabindex="-1"></a><span class="do">## Importation des GRIDS avec le package Terra</span></span>
<span id="cb390-35"><a href="sect052.html#cb390-35" tabindex="-1"></a>Fichier1 <span class="ot">&lt;-</span> <span class="fu">substr</span>(grids, <span class="dv">88</span>, <span class="dv">98</span>)</span>
<span id="cb390-36"><a href="sect052.html#cb390-36" tabindex="-1"></a>Fichier2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">substr</span>(<span class="fu">tolower</span>(Fichier1), <span class="dv">1</span>, <span class="dv">7</span>),</span>
<span id="cb390-37"><a href="sect052.html#cb390-37" tabindex="-1"></a>                    <span class="fu">substr</span>(Fichier1, <span class="dv">9</span>, <span class="dv">11</span>))</span>
<span id="cb390-38"><a href="sect052.html#cb390-38" tabindex="-1"></a>NomsFichiers <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;data/chap05/AutresDonnees/MNT/&quot;</span>,</span>
<span id="cb390-39"><a href="sect052.html#cb390-39" tabindex="-1"></a>                        Fichier1, <span class="st">&quot;/&quot;</span>,</span>
<span id="cb390-40"><a href="sect052.html#cb390-40" tabindex="-1"></a>                        Fichier2)</span>
<span id="cb390-41"><a href="sect052.html#cb390-41" tabindex="-1"></a>rlist <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb390-42"><a href="sect052.html#cb390-42" tabindex="-1"></a><span class="cf">for</span>(e <span class="cf">in</span> NomsFichiers) {</span>
<span id="cb390-43"><a href="sect052.html#cb390-43" tabindex="-1"></a> <span class="fu">print</span>(e)</span>
<span id="cb390-44"><a href="sect052.html#cb390-44" tabindex="-1"></a> rasterGrid <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(e)</span>
<span id="cb390-45"><a href="sect052.html#cb390-45" tabindex="-1"></a> rlist[[<span class="fu">length</span>(rlist)<span class="sc">+</span><span class="dv">1</span>]] <span class="ot">&lt;-</span> rasterGrid</span>
<span id="cb390-46"><a href="sect052.html#cb390-46" tabindex="-1"></a>}</span>
<span id="cb390-47"><a href="sect052.html#cb390-47" tabindex="-1"></a><span class="do">## Création d&#39;une mosaique avec les GRIDS</span></span>
<span id="cb390-48"><a href="sect052.html#cb390-48" tabindex="-1"></a>rsrc <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">sprc</span>(rlist)</span>
<span id="cb390-49"><a href="sect052.html#cb390-49" tabindex="-1"></a>MosaicSherbrooke <span class="ot">&lt;-</span> <span class="fu">mosaic</span>(rsrc)</span>
<span id="cb390-50"><a href="sect052.html#cb390-50" tabindex="-1"></a>MosaicSherbrooke</span>
<span id="cb390-51"><a href="sect052.html#cb390-51" tabindex="-1"></a></span>
<span id="cb390-52"><a href="sect052.html#cb390-52" tabindex="-1"></a><span class="do">## Exporter en GeoTIFF</span></span>
<span id="cb390-53"><a href="sect052.html#cb390-53" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(MosaicSherbrooke, </span>
<span id="cb390-54"><a href="sect052.html#cb390-54" tabindex="-1"></a>                  <span class="st">&quot;data/chap05/_DataReseau/Elevation.tif&quot;</span>,</span>
<span id="cb390-55"><a href="sect052.html#cb390-55" tabindex="-1"></a>                  <span class="at">filetype =</span> <span class="st">&quot;GTiff&quot;</span>,</span>
<span id="cb390-56"><a href="sect052.html#cb390-56" tabindex="-1"></a>                  <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb390-57"><a href="sect052.html#cb390-57" tabindex="-1"></a></span>
<span id="cb390-58"><a href="sect052.html#cb390-58" tabindex="-1"></a><span class="do">## Suppression des GRIDS</span></span>
<span id="cb390-59"><a href="sect052.html#cb390-59" tabindex="-1"></a>dossier <span class="ot">&lt;-</span> <span class="st">&quot;data/chap05/AutresDonnees/MNT/&quot;</span></span>
<span id="cb390-60"><a href="sect052.html#cb390-60" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">list.files</span>(dossier, <span class="at">include.dirs =</span> <span class="cn">FALSE</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb390-61"><a href="sect052.html#cb390-61" tabindex="-1"></a><span class="fu">file.remove</span>(f)</span>
<span id="cb390-62"><a href="sect052.html#cb390-62" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">list.dirs</span>(dossier)</span>
<span id="cb390-63"><a href="sect052.html#cb390-63" tabindex="-1"></a><span class="fu">unlink</span>(d, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Le fichier d’élévation ainsi construit est présenté à la figure <a href="sect052.html#fig:figMNT">5.7</a>.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="sect052.html#cb391-1" tabindex="-1"></a>MosaicSherbrooke <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;data/chap05/_DataReseau/Elevation.tif&quot;</span>)</span>
<span id="cb391-2"><a href="sect052.html#cb391-2" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(MosaicSherbrooke)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:figMNT"></span>
<img src="GMQ405_files/figure-html/figMNT-1.png" alt="Modèle numérique d'élévation au 1/20000 pour la région de Sherbrooke" width="65%" />
<p class="caption">
Figure 5.7: Modèle numérique d’élévation au 1/20000 pour la région de Sherbrooke
</p>
</div>
</div>
<div id="sect05214" class="section level4 hasAnchor" number="5.2.1.3">
<h4><span class="header-section-number">5.2.1.3</span> Extraction et validation d’un fichier GTFS<a href="sect052.html#sect05214" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Le fichier GTFS pour la Société de Transport de Sherbrooke est disponible à l’adresse suivante : <a href="https://gtfs.sts.qc.ca:8443/gtfs/client/GTFS_clients.zip" class="uri">https://gtfs.sts.qc.ca:8443/gtfs/client/GTFS_clients.zip</a>. Pour le télécharger, nous utilisons la fonction <code>download.file</code>.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="sect052.html#cb392-1" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://gtfs.sts.qc.ca:8443/gtfs/client/GTFS_clients.zip&quot;</span></span>
<span id="cb392-2"><a href="sect052.html#cb392-2" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="st">&quot;data/chap05/_DataReseau/GTFS_clients.zip&quot;</span></span>
<span id="cb392-3"><a href="sect052.html#cb392-3" tabindex="-1"></a><span class="fu">download.file</span>(url, destfile)</span></code></pre></div>
<p>Pour s’assurer du bon fonctionnement d’un GTFS dans <code>r5r</code>, il faut préalablement valider la structure du fichier. Dans un premier temps, vous pouvez valider la structure générale de votre GTFS en utilisant l’outil en ligne <a href="https://gtfs-validator.mobilitydata.org/">gtfs-validator</a> proposé par l’organisation <em>MobilityData</em>. Dans un second temps, il convient de s’assurer que les types de lignes utilisés font partie des types standards définis par <a href="https://developers.google.com/transit/gtfs/reference?hl=fr#routestxt">Google</a>, soit avec l’un des numéros suivants : 0, 1, 2, 3, 4, 5, 6, 7, 11, 12. Si votre GTFS contient des lignes de transport en commun provenant par exemple des <a href="https://developers.google.com/transit/gtfs/reference/extended-route-types?hl=fr">types étendus</a>, <code>r5r</code> renverra une erreur.</p>
<p>Nous vous proposons ci-dessous une fonction qui remplace les types problématiques dans un GTFS. Le plus simple est de les remplacer par un type <em>bus</em> (3), ce qui n’affectera pas les trajets estimés.</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="sect052.html#cb393-1" tabindex="-1"></a><span class="fu">library</span>(gtfstools)</span>
<span id="cb393-2"><a href="sect052.html#cb393-2" tabindex="-1"></a><span class="do">## Fonction</span></span>
<span id="cb393-3"><a href="sect052.html#cb393-3" tabindex="-1"></a>clean_gtfs_types <span class="ot">&lt;-</span> <span class="cf">function</span>(gtfs_file, <span class="at">replace_by =</span> <span class="dv">3</span>){</span>
<span id="cb393-4"><a href="sect052.html#cb393-4" tabindex="-1"></a>  <span class="co"># Lecture du GTFS</span></span>
<span id="cb393-5"><a href="sect052.html#cb393-5" tabindex="-1"></a>  seed <span class="ot">&lt;-</span> gtfstools<span class="sc">::</span><span class="fu">read_gtfs</span>(gtfs_file)</span>
<span id="cb393-6"><a href="sect052.html#cb393-6" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">unique</span>(seed<span class="sc">$</span>routes<span class="sc">$</span>route_type))</span>
<span id="cb393-7"><a href="sect052.html#cb393-7" tabindex="-1"></a>  <span class="co"># Vérification des types de routes</span></span>
<span id="cb393-8"><a href="sect052.html#cb393-8" tabindex="-1"></a>  seed<span class="sc">$</span>routes<span class="sc">$</span>route_type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb393-9"><a href="sect052.html#cb393-9" tabindex="-1"></a>    seed<span class="sc">$</span>routes<span class="sc">$</span>route_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">7</span>,<span class="dv">11</span>,<span class="dv">12</span>),</span>
<span id="cb393-10"><a href="sect052.html#cb393-10" tabindex="-1"></a>    seed<span class="sc">$</span>routes<span class="sc">$</span>route_type,</span>
<span id="cb393-11"><a href="sect052.html#cb393-11" tabindex="-1"></a>    replace_by</span>
<span id="cb393-12"><a href="sect052.html#cb393-12" tabindex="-1"></a>  )</span>
<span id="cb393-13"><a href="sect052.html#cb393-13" tabindex="-1"></a>  <span class="co"># Réécriture du fichier GTFS avec la modification</span></span>
<span id="cb393-14"><a href="sect052.html#cb393-14" tabindex="-1"></a>  gtfstools<span class="sc">::</span><span class="fu">write_gtfs</span>(seed, gtfs_file)</span>
<span id="cb393-15"><a href="sect052.html#cb393-15" tabindex="-1"></a>}</span>
<span id="cb393-16"><a href="sect052.html#cb393-16" tabindex="-1"></a><span class="do">## Appel de la fonction</span></span>
<span id="cb393-17"><a href="sect052.html#cb393-17" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="st">&quot;data/chap05/_DataReseau/GTFS_clients.zip&quot;</span></span>
<span id="cb393-18"><a href="sect052.html#cb393-18" tabindex="-1"></a><span class="fu">clean_gtfs_types</span>(destfile)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Pour ce fichier, le seul type de ligne utilisé est le numéro 3, soit des lignes de bus.</p>
</div>
</div>
<div id="sect0522" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Construction du réseau avec R5R<a href="sect052.html#sect0522" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="bloc_attention">
<p><strong><code>R5R</code> et JDK Java et allocation de la mémoire</strong></p>
<p>Le <em>package</em> <code>R5R</code> utilise la version 11 de la JDK de Java (<em>Java Development Kit</em>). Vous devez préalablement la <a href="https://www.oracle.com/ca-en/java/technologies/javase/jdk11-archive-downloads.html">télécharger</a> et l’installer sur votre ordinateur. Les deux lignes de code ci-dessous permettent de vérifier si elle est bien installée sur votre ordinateur.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="sect052.html#cb395-1" tabindex="-1"></a><span class="do">## Vérification que la JDK version 11 est bien installée</span></span>
<span id="cb395-2"><a href="sect052.html#cb395-2" tabindex="-1"></a>rJava<span class="sc">::</span><span class="fu">.jinit</span>()</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="sect052.html#cb397-1" tabindex="-1"></a>rJava<span class="sc">::</span><span class="fu">.jcall</span>(<span class="st">&quot;java.lang.System&quot;</span>, <span class="st">&quot;S&quot;</span>, <span class="st">&quot;getProperty&quot;</span>, <span class="st">&quot;java.version&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;11.0.19&quot;</code></pre>
<p>Il est fortement conseillé d’augmenter la mémoire allouée au processus JAVA, surtout si vous souhaitez calculer des matrices origines-destinations de grande taille. Par exemple, la commande <code>options(java.parameters = "-Xmx2G")</code> permet d’augmenter la mémoire disponible pour JAVA à deux gigaoctets. Si votre ordinateur ne manque pas de mémoire vive (16, 32 ou 64 gigaoctets), n’hésitez pas à augmenter ce paramètre (par exemple, <code>options(java.parameters = "-Xmx8G")</code>).</p>
</div>
<p>Nous utilisons la fonction <code>setup_r5</code> pour construire un réseau multimode à partir des trois fichiers :</p>
<ul>
<li>Le fichier OSM (<code>openstreetmap_fr_sherbrooke.pbf</code>).</li>
<li>Le fichier GTFS pour la Société de Transport de Sherbrooke (<code>GTFS_clients.zip</code>).</li>
<li>Le fichier d’élévation pour la région de Sherbrooke (<code>Elevation.tif</code>).</li>
</ul>
<p>Notez les paramètres suivants pour la fonction <code>setup_r5</code> :</p>
<ul>
<li><code>data_path</code> pour définir le dossier dans lequel sont présents les trois fichiers.</li>
<li><code>elevation = "TOBLER"</code> pour utiliser la fonction d’impédance de Tobler pour la marche et le vélo qui prend en compte la pente.</li>
<li><code>overwrite = FALSE</code> pour ne pas écraser le réseau s’il est déjà construit. La construction d’un réseau peut être très longue dépendamment de la taille des trois fichiers (OSM, GTFS, élévation). Par conséquent, n’oubliez pas de spécifier cette option si votre réseau a été construit.</li>
</ul>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="sect052.html#cb399-1" tabindex="-1"></a><span class="fu">library</span>(r5r)</span>
<span id="cb399-2"><a href="sect052.html#cb399-2" tabindex="-1"></a><span class="do">## Allocation de la mémoire pour Java</span></span>
<span id="cb399-3"><a href="sect052.html#cb399-3" tabindex="-1"></a><span class="fu">options</span>(<span class="at">java.parameters =</span> <span class="st">&quot;-Xmx2G&quot;</span>)</span>
<span id="cb399-4"><a href="sect052.html#cb399-4" tabindex="-1"></a><span class="do">## Construction du réseau R5R</span></span>
<span id="cb399-5"><a href="sect052.html#cb399-5" tabindex="-1"></a>r5r_core <span class="ot">&lt;-</span> <span class="fu">setup_r5</span>(<span class="at">data_path =</span> <span class="st">&quot;data/chap05/_DataReseau/&quot;</span>,</span>
<span id="cb399-6"><a href="sect052.html#cb399-6" tabindex="-1"></a>                     <span class="at">elevation =</span> <span class="st">&quot;TOBLER&quot;</span>,</span>
<span id="cb399-7"><a href="sect052.html#cb399-7" tabindex="-1"></a>                     <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">overwrite =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>La fonction <code>setup_r5</code> a créé deux nouveaux fichiers (<em>network.dat</em> et <em>network_settings.json</em>) qui sont utilisés par le <em>package</em> <code>r5r</code> pour les analyses de réseau.</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="sect052.html#cb400-1" tabindex="-1"></a><span class="do">## Liste des fichiers dans le dossier </span></span>
<span id="cb400-2"><a href="sect052.html#cb400-2" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">&quot;data/chap05/_DataReseau/&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Elevation.tif&quot;                          
## [2] &quot;GTFS_clients.zip&quot;                       
## [3] &quot;network.dat&quot;                            
## [4] &quot;network_settings.json&quot;                  
## [5] &quot;openstreetmap_fr_sherbrooke.pbf&quot;        
## [6] &quot;openstreetmap_fr_sherbrooke.pbf.mapdb&quot;  
## [7] &quot;openstreetmap_fr_sherbrooke.pbf.mapdb.p&quot;</code></pre>
</div>
<div id="sect0523" class="section level3 hasAnchor" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Calcul d’itinéraires avec R5R selon le mode de transport<a href="sect052.html#sect0523" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pour calculer un trajet, nous utilisons la fonction <code>detailed_itineraries</code> dont les paramètres sont décrits dans l’encadré ci-dessous.</p>
<div class="bloc_notes">
<p><strong>Paramètres de la fonction <code>detailed_itineraries</code></strong></p>
<ul>
<li><strong><code>r5r_core</code></strong>: le réseau créé avec la fonction <code>setup_r5()</code> décrite plus haut.</li>
<li><strong><code>origins</code></strong>: un point <code>sf</code> projeté en WGS84 ou un <code>data.frame</code> comprenant les colonnes <code>id</code>, <code>lon</code> et <code>lat</code>.</li>
<li><strong><code>destinations</code></strong>: un point <code>sf</code> projeté en WGS84 ou un <code>data.frame</code> comprenant les colonnes <code>id</code>, <code>lon</code> et <code>lat</code>.</li>
<li><strong><code>mode</code></strong>: un vecteur de type caractères définissant les modes de transport dont les principaux sont :
<ul>
<li><code>"WALK"</code> pour la marche.</li>
<li><code>"BICYCLE"</code> pour le vélo.</li>
<li><code>"CAR"</code> pour l’automobile.</li>
<li><code>"c("WALK",TRANSIT")</code> pour la marche et le transport en commun.</li>
</ul></li>
<li><strong><code>departure_datetime</code></strong>: un objet <code>POSIXct</code> définissant la date et l’heure de départ à utiliser si vous souhaitez calculer un trajet en transport en commun.</li>
<li><strong><code>max_walk_time=inf</code></strong>: un nombre entier définissant le temps de marche maximal en minutes pour chaque segment du trajet. La valeur par défaut est sans limite (<code>Inf</code>).</li>
<li><strong><code>max_bike_time=Inf</code></strong>: un nombre entier définissant le temps maximal à vélo en minutes.</li>
<li><strong><code>max_car_time=Inf</code></strong>: un nombre entier définissant le temps maximal en automobile en minutes.</li>
<li><strong><code>max_trip_duration=120</code></strong>: un nombre entier définissant le temps maximal du trajet qui est fixé à 120 minutes par défaut. Par conséquent, tout trajet d’une durée supérieure à ce seuil ne sera pas calculé.</li>
<li><strong><code>walk_speed = 3.6</code></strong>: une valeur numérique définissant la vitesse moyenne de marche qui est fixée par défaut à 3,6 km/h. Ce seuil est très conservateur et pourrait être augmenté à 4,5 km/h.</li>
<li><strong><code>bike_speed = 12</code></strong>: une valeur numérique définissant la vitesse moyenne à vélo qui est fixée par défaut à 12 km/h. Ce seuil est aussi très conservateur et pourrait être augmenté à 15 ou 16 km/h.</li>
<li><strong><code>max_lts = 2</code></strong>: un nombre entier de 1 à 4 qui indique le niveau de stress lié à la circulation que les cyclistes sont prêts à tolérer. Une valeur de 1 signifie que les cyclistes n’emprunteront que les rues les plus calmes, tandis qu’une valeur de 4 indique que les cyclistes peuvent emprunter n’importe quelle route.
<ul>
<li><code>max_lts = 1</code>: tolérable pour les enfants.</li>
<li><code>max_lts = 2</code>: tolérable pour la population adulte en général.</li>
<li><code>max_lts = 3</code>: tolérable pour les cyclistes enthousiastes et confiants.</li>
<li><code>max_lts = 4</code>: tolérable uniquement pour les cyclistes intrépides.</li>
</ul></li>
<li><strong><code>drop_geometry = FALSE</code></strong>: si ce paramètre est fixé à TRUE, la géométrie du trajet ne sera pas incluse.</li>
</ul>
</div>
<div id="sect05231" class="section level4 hasAnchor" number="5.2.3.1">
<h4><span class="header-section-number">5.2.3.1</span> Calcul d’itinéraires selon les modes de transport actif<a href="sect052.html#sect05231" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Dans un premier temps, nous calculons des trajets à vélo entre les deux localisations suivantes :</p>
<ul>
<li>Le point <code>Pt.W</code> situé à l’intersection de la rue Wellington et de la Côte de l’Acadie (45,38947; -71,88393).</li>
<li>Le point <code>Pt.D</code> situé à l’intersection des rues Darche et Dorval (45,38353; -71,89169).</li>
</ul>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="sect052.html#cb402-1" tabindex="-1"></a><span class="do">## Création d&#39;une couche sf avec les deux points</span></span>
<span id="cb402-2"><a href="sect052.html#cb402-2" tabindex="-1"></a>Pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="st">&quot;Rue Wellington S.&quot;</span>, <span class="st">&quot;Rue Darche&quot;</span>),</span>
<span id="cb402-3"><a href="sect052.html#cb402-3" tabindex="-1"></a>                         <span class="at">lat =</span> <span class="fu">c</span>( <span class="fl">45.38947</span>,  <span class="fl">45.38353</span>),</span>
<span id="cb402-4"><a href="sect052.html#cb402-4" tabindex="-1"></a>                         <span class="at">lon =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">71.88393</span>, <span class="sc">-</span><span class="fl">71.89169</span>)</span>
<span id="cb402-5"><a href="sect052.html#cb402-5" tabindex="-1"></a>                         )</span>
<span id="cb402-6"><a href="sect052.html#cb402-6" tabindex="-1"></a>Pts <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(Pts, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>,<span class="st">&quot;lat&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb402-7"><a href="sect052.html#cb402-7" tabindex="-1"></a>Pt.W <span class="ot">&lt;-</span> Pts[<span class="dv">1</span>,]</span>
<span id="cb402-8"><a href="sect052.html#cb402-8" tabindex="-1"></a>Pt.D <span class="ot">&lt;-</span> Pts[<span class="dv">2</span>,]</span>
<span id="cb402-9"><a href="sect052.html#cb402-9" tabindex="-1"></a><span class="do">## Trajets en vélo</span></span>
<span id="cb402-10"><a href="sect052.html#cb402-10" tabindex="-1"></a>velo<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb402-11"><a href="sect052.html#cb402-11" tabindex="-1"></a>                               <span class="at">origins =</span> Pt.W,</span>
<span id="cb402-12"><a href="sect052.html#cb402-12" tabindex="-1"></a>                               <span class="at">destinations =</span> Pt.D,</span>
<span id="cb402-13"><a href="sect052.html#cb402-13" tabindex="-1"></a>                               <span class="at">mode =</span> <span class="st">&quot;BICYCLE&quot;</span>, <span class="co"># Vélo</span></span>
<span id="cb402-14"><a href="sect052.html#cb402-14" tabindex="-1"></a>                               <span class="at">bike_speed =</span> <span class="dv">12</span>,</span>
<span id="cb402-15"><a href="sect052.html#cb402-15" tabindex="-1"></a>                               <span class="at">shortest_path =</span> <span class="cn">FALSE</span>,</span>
<span id="cb402-16"><a href="sect052.html#cb402-16" tabindex="-1"></a>                               <span class="at">drop_geometry =</span> <span class="cn">FALSE</span>)</span>
<span id="cb402-17"><a href="sect052.html#cb402-17" tabindex="-1"></a>velo<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb402-18"><a href="sect052.html#cb402-18" tabindex="-1"></a>                               <span class="at">origins =</span> Pt.D,</span>
<span id="cb402-19"><a href="sect052.html#cb402-19" tabindex="-1"></a>                               <span class="at">destinations =</span> Pt.W,</span>
<span id="cb402-20"><a href="sect052.html#cb402-20" tabindex="-1"></a>                               <span class="at">mode =</span> <span class="st">&quot;BICYCLE&quot;</span>, <span class="co"># Vélo</span></span>
<span id="cb402-21"><a href="sect052.html#cb402-21" tabindex="-1"></a>                               <span class="at">bike_speed =</span> <span class="dv">12</span>,</span>
<span id="cb402-22"><a href="sect052.html#cb402-22" tabindex="-1"></a>                               <span class="at">shortest_path =</span> <span class="cn">FALSE</span>,</span>
<span id="cb402-23"><a href="sect052.html#cb402-23" tabindex="-1"></a>                               <span class="at">drop_geometry =</span> <span class="cn">FALSE</span>)</span>
<span id="cb402-24"><a href="sect052.html#cb402-24" tabindex="-1"></a>velo<span class="fl">.1</span></span></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 16 fields
## Geometry type: LINESTRING
## Dimension:     XY
## Bounding box:  xmin: -71.89191 ymin: 45.3835 xmax: -71.88387 ymax: 45.38955
## Geodetic CRS:  WGS 84
##             from_id from_lat  from_lon      to_id   to_lat    to_lon option
## 1 Rue Wellington S. 45.38947 -71.88393 Rue Darche 45.38353 -71.89169      1
##   departure_time total_duration total_distance segment    mode segment_duration
## 1       10:24:41            8.1           1215       1 BICYCLE              8.1
##   wait distance route                       geometry
## 1    0     1215       LINESTRING (-71.88396 45.38...</code></pre>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="sect052.html#cb404-1" tabindex="-1"></a>velo<span class="fl">.2</span></span></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 16 fields
## Geometry type: LINESTRING
## Dimension:     XY
## Bounding box:  xmin: -71.89191 ymin: 45.3835 xmax: -71.88387 ymax: 45.38955
## Geodetic CRS:  WGS 84
##      from_id from_lat  from_lon             to_id   to_lat    to_lon option
## 1 Rue Darche 45.38353 -71.89169 Rue Wellington S. 45.38947 -71.88393      1
##   departure_time total_duration total_distance segment    mode segment_duration
## 1       10:24:42            6.5           1215       1 BICYCLE              6.5
##   wait distance route                       geometry
## 1    0     1215       LINESTRING (-71.89191 45.38...</code></pre>
<p>Avec la fonction <code>detailed_itineraries</code>, les durées sont estimées à respectivement six et huit minutes (figure <a href="sect052.html#fig:TrajetsVelo">5.8</a>). Bien que le chemin emprunté soit le même, cet écart s’explique par la Côte de l’Acadie, soit l’un des tronçons de rue les plus pentues de la ville de Sherbrooke. Pour visualiser les trajets, nous utilisons le <em>package</em> <code>tmap</code> en mode <code>view</code>. Notez qu’un clic sur le trajet fait apparaître une fenêtre surgissante.</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="sect052.html#cb406-1" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb406-2"><a href="sect052.html#cb406-2" tabindex="-1"></a><span class="co"># Cartographie des trajets avec tmap</span></span>
<span id="cb406-3"><a href="sect052.html#cb406-3" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;view&quot;</span>)</span>
<span id="cb406-4"><a href="sect052.html#cb406-4" tabindex="-1"></a>Carte1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(velo<span class="fl">.1</span>)<span class="sc">+</span></span>
<span id="cb406-5"><a href="sect052.html#cb406-5" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb406-6"><a href="sect052.html#cb406-6" tabindex="-1"></a>           <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">&quot;mode&quot;</span>, <span class="st">&quot;from_id&quot;</span>, <span class="st">&quot;to_id&quot;</span>, <span class="st">&quot;segment_duration&quot;</span>, <span class="st">&quot;distance&quot;</span>))<span class="sc">+</span></span>
<span id="cb406-7"><a href="sect052.html#cb406-7" tabindex="-1"></a>  <span class="fu">tm_shape</span>(Pt.W)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb406-8"><a href="sect052.html#cb406-8" tabindex="-1"></a>  <span class="fu">tm_shape</span>(Pt.D)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)</span>
<span id="cb406-9"><a href="sect052.html#cb406-9" tabindex="-1"></a>Carte2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(velo<span class="fl">.2</span>)<span class="sc">+</span></span>
<span id="cb406-10"><a href="sect052.html#cb406-10" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb406-11"><a href="sect052.html#cb406-11" tabindex="-1"></a>           <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">&quot;mode&quot;</span>, <span class="st">&quot;from_id&quot;</span>, <span class="st">&quot;to_id&quot;</span>, <span class="st">&quot;segment_duration&quot;</span>, <span class="st">&quot;distance&quot;</span>))<span class="sc">+</span></span>
<span id="cb406-12"><a href="sect052.html#cb406-12" tabindex="-1"></a>  <span class="fu">tm_shape</span>(Pt.D)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb406-13"><a href="sect052.html#cb406-13" tabindex="-1"></a>  <span class="fu">tm_shape</span>(Pt.W)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)</span>
<span id="cb406-14"><a href="sect052.html#cb406-14" tabindex="-1"></a><span class="fu">tmap_arrange</span>(Carte1, Carte2)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:TrajetsVelo"></span>
<img src="images/Chap05/TrajetsVelo.png" alt="Trajets à vélo entre les deux destinations" width="100%" />
<p class="caption">
Figure 5.8: Trajets à vélo entre les deux destinations
</p>
</div>
<p>Dans un second temps, nous calculons les trajets à pied avec les deux mêmes localisations qui sont estimées à 16 et 21 minutes (figure <a href="sect052.html#fig:TrajetsMarche">5.9</a>).</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="sect052.html#cb407-1" tabindex="-1"></a>marche<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb407-2"><a href="sect052.html#cb407-2" tabindex="-1"></a>                                 <span class="at">origins =</span> Pt.W,</span>
<span id="cb407-3"><a href="sect052.html#cb407-3" tabindex="-1"></a>                                 <span class="at">destinations =</span> Pt.D,</span>
<span id="cb407-4"><a href="sect052.html#cb407-4" tabindex="-1"></a>                                 <span class="at">mode =</span> <span class="st">&quot;WALK&quot;</span>, <span class="co"># Marche</span></span>
<span id="cb407-5"><a href="sect052.html#cb407-5" tabindex="-1"></a>                                 <span class="at">walk_speed =</span> <span class="fl">4.5</span>,  <span class="co"># par défaut 3.6</span></span>
<span id="cb407-6"><a href="sect052.html#cb407-6" tabindex="-1"></a>                                 <span class="at">shortest_path =</span> <span class="cn">FALSE</span>,</span>
<span id="cb407-7"><a href="sect052.html#cb407-7" tabindex="-1"></a>                                 <span class="at">drop_geometry =</span> <span class="cn">FALSE</span>)</span>
<span id="cb407-8"><a href="sect052.html#cb407-8" tabindex="-1"></a>marche<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb407-9"><a href="sect052.html#cb407-9" tabindex="-1"></a>                                 <span class="at">origins =</span> Pt.D,</span>
<span id="cb407-10"><a href="sect052.html#cb407-10" tabindex="-1"></a>                                 <span class="at">destinations =</span> Pt.W,</span>
<span id="cb407-11"><a href="sect052.html#cb407-11" tabindex="-1"></a>                                 <span class="at">mode =</span> <span class="st">&quot;WALK&quot;</span>, <span class="co"># Marche</span></span>
<span id="cb407-12"><a href="sect052.html#cb407-12" tabindex="-1"></a>                                 <span class="at">walk_speed =</span> <span class="fl">4.5</span>,</span>
<span id="cb407-13"><a href="sect052.html#cb407-13" tabindex="-1"></a>                                 <span class="at">shortest_path =</span> <span class="cn">FALSE</span>,</span>
<span id="cb407-14"><a href="sect052.html#cb407-14" tabindex="-1"></a>                                 <span class="at">drop_geometry =</span> <span class="cn">FALSE</span>)</span>
<span id="cb407-15"><a href="sect052.html#cb407-15" tabindex="-1"></a><span class="co"># Cartographie des trajets avec tmap</span></span>
<span id="cb407-16"><a href="sect052.html#cb407-16" tabindex="-1"></a>Carte3 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(marche<span class="fl">.1</span>)<span class="sc">+</span></span>
<span id="cb407-17"><a href="sect052.html#cb407-17" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb407-18"><a href="sect052.html#cb407-18" tabindex="-1"></a>           <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">&quot;mode&quot;</span>, <span class="st">&quot;from_id&quot;</span>, <span class="st">&quot;to_id&quot;</span>, <span class="st">&quot;segment_duration&quot;</span>, <span class="st">&quot;distance&quot;</span>))<span class="sc">+</span></span>
<span id="cb407-19"><a href="sect052.html#cb407-19" tabindex="-1"></a>  <span class="fu">tm_shape</span>(Pt.W)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb407-20"><a href="sect052.html#cb407-20" tabindex="-1"></a>  <span class="fu">tm_shape</span>(Pt.D)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)</span>
<span id="cb407-21"><a href="sect052.html#cb407-21" tabindex="-1"></a>Carte4 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(marche<span class="fl">.2</span>)<span class="sc">+</span></span>
<span id="cb407-22"><a href="sect052.html#cb407-22" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb407-23"><a href="sect052.html#cb407-23" tabindex="-1"></a>           <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">&quot;mode&quot;</span>, <span class="st">&quot;from_id&quot;</span>, <span class="st">&quot;to_id&quot;</span>, <span class="st">&quot;segment_duration&quot;</span>, <span class="st">&quot;distance&quot;</span>))<span class="sc">+</span></span>
<span id="cb407-24"><a href="sect052.html#cb407-24" tabindex="-1"></a>  <span class="fu">tm_shape</span>(Pt.D)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb407-25"><a href="sect052.html#cb407-25" tabindex="-1"></a>  <span class="fu">tm_shape</span>(Pt.W)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)</span>
<span id="cb407-26"><a href="sect052.html#cb407-26" tabindex="-1"></a><span class="fu">tmap_arrange</span>(Carte3, Carte4)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:TrajetsMarche"></span>
<img src="images/Chap05/TrajetsMarche.png" alt="Trajets à pied entre les deux destinations" width="100%" />
<p class="caption">
Figure 5.9: Trajets à pied entre les deux destinations
</p>
</div>
</div>
<div id="sect05232" class="section level4 hasAnchor" number="5.2.3.2">
<h4><span class="header-section-number">5.2.3.2</span> Calcul d’itinéraires en automobile<a href="sect052.html#sect05232" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Nous calculons ici l’itinéraire entre le campus principal de l’<a href="https://www.usherbrooke.ca/">Université de Sherbrooke</a> et une localisation (45,4220308; -71,881828). Nous fixons alors <code>mode = "CAR"</code> pour la fonction <code>detailed_itineraries</code>. Les trajets sont respectivement estimés à 21,7 et 18,8 minutes à destination et au départ du campus principal.</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="sect052.html#cb408-1" tabindex="-1"></a>UDeS <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="st">&quot;Campus principal&quot;</span>, <span class="at">lon =</span> <span class="sc">-</span><span class="fl">71.929526</span>, <span class="at">lat =</span> <span class="fl">45.378017</span>)</span>
<span id="cb408-2"><a href="sect052.html#cb408-2" tabindex="-1"></a>UDeS <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(UDeS, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>,<span class="st">&quot;lat&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb408-3"><a href="sect052.html#cb408-3" tabindex="-1"></a>Point <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="st">&quot;Départ&quot;</span>, <span class="at">lon =</span> <span class="sc">-</span><span class="fl">71.881828</span>, <span class="at">lat =</span> <span class="fl">45.4220308</span>)</span>
<span id="cb408-4"><a href="sect052.html#cb408-4" tabindex="-1"></a>Point <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(Point, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>,<span class="st">&quot;lat&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb408-5"><a href="sect052.html#cb408-5" tabindex="-1"></a></span>
<span id="cb408-6"><a href="sect052.html#cb408-6" tabindex="-1"></a>Auto.Aller <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb408-7"><a href="sect052.html#cb408-7" tabindex="-1"></a>                                 <span class="at">origins =</span> Point,</span>
<span id="cb408-8"><a href="sect052.html#cb408-8" tabindex="-1"></a>                                 <span class="at">destinations =</span> UDeS,</span>
<span id="cb408-9"><a href="sect052.html#cb408-9" tabindex="-1"></a>                                 <span class="at">mode =</span> <span class="st">&quot;CAR&quot;</span>, <span class="co"># Automobile</span></span>
<span id="cb408-10"><a href="sect052.html#cb408-10" tabindex="-1"></a>                                 <span class="at">shortest_path =</span> <span class="cn">FALSE</span>,</span>
<span id="cb408-11"><a href="sect052.html#cb408-11" tabindex="-1"></a>                                 <span class="at">drop_geometry =</span> <span class="cn">FALSE</span>)</span>
<span id="cb408-12"><a href="sect052.html#cb408-12" tabindex="-1"></a>Auto.Retour <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb408-13"><a href="sect052.html#cb408-13" tabindex="-1"></a>                               <span class="at">origins =</span> UDeS,</span>
<span id="cb408-14"><a href="sect052.html#cb408-14" tabindex="-1"></a>                               <span class="at">destinations =</span> Point,</span>
<span id="cb408-15"><a href="sect052.html#cb408-15" tabindex="-1"></a>                               <span class="at">mode =</span> <span class="st">&quot;CAR&quot;</span>, <span class="co"># Automobile</span></span>
<span id="cb408-16"><a href="sect052.html#cb408-16" tabindex="-1"></a>                               <span class="at">shortest_path =</span> <span class="cn">FALSE</span>,</span>
<span id="cb408-17"><a href="sect052.html#cb408-17" tabindex="-1"></a>                               <span class="at">drop_geometry =</span> <span class="cn">FALSE</span>)</span>
<span id="cb408-18"><a href="sect052.html#cb408-18" tabindex="-1"></a>Auto.Aller</span></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 16 fields
## Geometry type: LINESTRING
## Dimension:     XY
## Bounding box:  xmin: -71.93373 ymin: 45.37722 xmax: -71.88129 ymax: 45.42365
## Geodetic CRS:  WGS 84
##   from_id from_lat  from_lon            to_id   to_lat    to_lon option
## 1  Départ 45.42203 -71.88183 Campus principal 45.37802 -71.92953      1
##   departure_time total_duration total_distance segment mode segment_duration
## 1       10:24:43           21.7          11352       1  CAR             21.7
##   wait distance route                       geometry
## 1    0    11352       LINESTRING (-71.88129 45.42...</code></pre>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="sect052.html#cb410-1" tabindex="-1"></a>Auto.Retour</span></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 16 fields
## Geometry type: LINESTRING
## Dimension:     XY
## Bounding box:  xmin: -71.93312 ymin: 45.37759 xmax: -71.87607 ymax: 45.42234
## Geodetic CRS:  WGS 84
##            from_id from_lat  from_lon  to_id   to_lat    to_lon option
## 1 Campus principal 45.37802 -71.92953 Départ 45.42203 -71.88183      1
##   departure_time total_duration total_distance segment mode segment_duration
## 1       10:24:43           18.8           9685       1  CAR             18.8
##   wait distance route                       geometry
## 1    0     9685       LINESTRING (-71.92952 45.37...</code></pre>
<p>Bien entendu, les deux trajets sont différents en raison des sens de circulation (figure <a href="sect052.html#fig:TrajetsAuto">5.10</a>).</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="sect052.html#cb412-1" tabindex="-1"></a><span class="co"># Cartographie des trajets avec tmap</span></span>
<span id="cb412-2"><a href="sect052.html#cb412-2" tabindex="-1"></a>Carte1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(Auto.Aller)<span class="sc">+</span></span>
<span id="cb412-3"><a href="sect052.html#cb412-3" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb412-4"><a href="sect052.html#cb412-4" tabindex="-1"></a>           <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">&quot;mode&quot;</span>, <span class="st">&quot;from_id&quot;</span>, <span class="st">&quot;to_id&quot;</span>, <span class="st">&quot;segment_duration&quot;</span>, <span class="st">&quot;distance&quot;</span>))<span class="sc">+</span></span>
<span id="cb412-5"><a href="sect052.html#cb412-5" tabindex="-1"></a>  <span class="fu">tm_shape</span>(Point)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb412-6"><a href="sect052.html#cb412-6" tabindex="-1"></a>  <span class="fu">tm_shape</span>(UDeS)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)</span>
<span id="cb412-7"><a href="sect052.html#cb412-7" tabindex="-1"></a>Carte2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(Auto.Retour)<span class="sc">+</span></span>
<span id="cb412-8"><a href="sect052.html#cb412-8" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb412-9"><a href="sect052.html#cb412-9" tabindex="-1"></a>           <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">&quot;mode&quot;</span>, <span class="st">&quot;from_id&quot;</span>, <span class="st">&quot;to_id&quot;</span>, <span class="st">&quot;segment_duration&quot;</span>, <span class="st">&quot;distance&quot;</span>))<span class="sc">+</span></span>
<span id="cb412-10"><a href="sect052.html#cb412-10" tabindex="-1"></a>  <span class="fu">tm_shape</span>(Point)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb412-11"><a href="sect052.html#cb412-11" tabindex="-1"></a>  <span class="fu">tm_shape</span>(UDeS)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)</span>
<span id="cb412-12"><a href="sect052.html#cb412-12" tabindex="-1"></a><span class="co"># Figure avec les deux cartes</span></span>
<span id="cb412-13"><a href="sect052.html#cb412-13" tabindex="-1"></a><span class="fu">tmap_arrange</span>(Carte1, Carte2)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:TrajetsAuto"></span>
<img src="images/Chap05/TrajetsAuto.png" alt="Trajets en voiture entre les deux destinations" width="100%" />
<p class="caption">
Figure 5.10: Trajets en voiture entre les deux destinations
</p>
</div>
</div>
<div id="sect05233" class="section level4 hasAnchor" number="5.2.3.3">
<h4><span class="header-section-number">5.2.3.3</span> Calcul d’itinéraires en transport en commun<a href="sect052.html#sect05233" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Pour le calcul d’itinéraires en transport en commun, nous devons fixer une heure de départ et un temps de marche maximal pour chaque segment du trajet réalisé à pied, soit :</p>
<ul>
<li>du domicile à l’arrêt de bus le plus proche;</li>
<li>entre deux arrêts de bus de lignes différentes;</li>
<li>du dernier arrêt de bus à la destination finale.</li>
</ul>
<p>Dans le code ci-dessous, nous fixons les heures de départ et d’arrivée à 8 h et à 18 h pour le 4 mai 2023 et un temps de marche maximal de 20 minutes.</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="sect052.html#cb413-1" tabindex="-1"></a><span class="do">### Définition de la journée et de l&#39;heure de départ</span></span>
<span id="cb413-2"><a href="sect052.html#cb413-2" tabindex="-1"></a>dateheure.matin <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;04-05-2023 08:00:00&quot;</span>,</span>
<span id="cb413-3"><a href="sect052.html#cb413-3" tabindex="-1"></a>                              <span class="at">format =</span> <span class="st">&quot;%d-%m-%Y %H:%M:%S&quot;</span>)</span>
<span id="cb413-4"><a href="sect052.html#cb413-4" tabindex="-1"></a>dateheure.soir  <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;04-05-2023 18:00:00&quot;</span>,</span>
<span id="cb413-5"><a href="sect052.html#cb413-5" tabindex="-1"></a>                              <span class="at">format =</span> <span class="st">&quot;%d-%m-%Y %H:%M:%S&quot;</span>)</span>
<span id="cb413-6"><a href="sect052.html#cb413-6" tabindex="-1"></a><span class="do">### Définition du temps de marche maximal</span></span>
<span id="cb413-7"><a href="sect052.html#cb413-7" tabindex="-1"></a>minutes_marches_max <span class="ot">&lt;-</span> <span class="dv">20</span></span></code></pre></div>
<p>Toujours avec la fonction <code>detailed_itineraries</code>, nous modifions les paramètres comme suit :</p>
<ul>
<li><code>mode = c("WALK", "TRANSIT")</code> pour le transport en commun.</li>
<li><code>walk_speed = 4.5</code> pour une vitesse moyenne à la marche de 4,5 km/h.</li>
<li><code>departure_datetime = dateheure.matin</code> pour un départ le 4 mai 2023 à 8 h.</li>
<li><code>departure_datetime = dateheure.soir</code> pour un départ le 4 mai 2023 à 18 h.</li>
<li><code>max_walk_time = minutes_marches_max</code> pour un temps maximal de marche de 20 minutes.</li>
</ul>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="sect052.html#cb414-1" tabindex="-1"></a>TC.Aller <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb414-2"><a href="sect052.html#cb414-2" tabindex="-1"></a>                                   <span class="at">origins =</span> Point,</span>
<span id="cb414-3"><a href="sect052.html#cb414-3" tabindex="-1"></a>                                   <span class="at">destinations =</span> UDeS,</span>
<span id="cb414-4"><a href="sect052.html#cb414-4" tabindex="-1"></a>                                   <span class="at">mode =</span> <span class="fu">c</span>(<span class="st">&quot;WALK&quot;</span>, <span class="st">&quot;TRANSIT&quot;</span>),</span>
<span id="cb414-5"><a href="sect052.html#cb414-5" tabindex="-1"></a>                                   <span class="at">max_walk_time =</span> minutes_marches_max,</span>
<span id="cb414-6"><a href="sect052.html#cb414-6" tabindex="-1"></a>                                   <span class="at">walk_speed =</span> <span class="fl">4.5</span>,</span>
<span id="cb414-7"><a href="sect052.html#cb414-7" tabindex="-1"></a>                                   <span class="at">departure_datetime =</span> dateheure.matin,</span>
<span id="cb414-8"><a href="sect052.html#cb414-8" tabindex="-1"></a>                                   <span class="at">shortest_path =</span> <span class="cn">FALSE</span>,</span>
<span id="cb414-9"><a href="sect052.html#cb414-9" tabindex="-1"></a>                                   <span class="at">drop_geometry =</span> <span class="cn">FALSE</span>)</span>
<span id="cb414-10"><a href="sect052.html#cb414-10" tabindex="-1"></a>TC.Retour <span class="ot">&lt;-</span> <span class="fu">detailed_itineraries</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb414-11"><a href="sect052.html#cb414-11" tabindex="-1"></a>                                    <span class="at">origins =</span> UDeS,</span>
<span id="cb414-12"><a href="sect052.html#cb414-12" tabindex="-1"></a>                                    <span class="at">destinations =</span> Point,</span>
<span id="cb414-13"><a href="sect052.html#cb414-13" tabindex="-1"></a>                                    <span class="at">mode =</span> <span class="fu">c</span>(<span class="st">&quot;WALK&quot;</span>, <span class="st">&quot;TRANSIT&quot;</span>),</span>
<span id="cb414-14"><a href="sect052.html#cb414-14" tabindex="-1"></a>                                    <span class="at">max_walk_time =</span> minutes_marches_max,</span>
<span id="cb414-15"><a href="sect052.html#cb414-15" tabindex="-1"></a>                                    <span class="at">walk_speed =</span> <span class="fl">4.5</span>,</span>
<span id="cb414-16"><a href="sect052.html#cb414-16" tabindex="-1"></a>                                    <span class="at">departure_datetime =</span> dateheure.soir,</span>
<span id="cb414-17"><a href="sect052.html#cb414-17" tabindex="-1"></a>                                    <span class="at">shortest_path =</span> <span class="cn">FALSE</span>,</span>
<span id="cb414-18"><a href="sect052.html#cb414-18" tabindex="-1"></a>                                    <span class="at">drop_geometry =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>La durée du trajet à 8 h vers l’Université de Sherbrooke est estimée à 46,9 minutes avec trois segments :</p>
<ul>
<li>Un premier segment de 17,2 minutes et 1,4 km à pied.</li>
<li>Un second de 25 minutes en autobus.</li>
<li>Un troisième de 1,8 minute et 127 mètres en autobus.</li>
</ul>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="sect052.html#cb415-1" tabindex="-1"></a>TC.Aller</span></code></pre></div>
<pre><code>## Simple feature collection with 3 features and 16 fields
## Geometry type: LINESTRING
## Dimension:     XY
## Bounding box:  xmin: -71.92952 ymin: 45.37756 xmax: -71.88129 ymax: 45.42204
## Geodetic CRS:  WGS 84
##   from_id from_lat  from_lon            to_id   to_lat    to_lon option
## 1  Départ 45.42203 -71.88183 Campus principal 45.37802 -71.92953      1
## 2  Départ 45.42203 -71.88183 Campus principal 45.37802 -71.92953      1
## 3  Départ 45.42203 -71.88183 Campus principal 45.37802 -71.92953      1
##   departure_time total_duration total_distance segment mode segment_duration
## 1       08:00:55           46.9           9141       1 WALK             17.2
## 2       08:00:55           46.9           9141       2  BUS             25.0
## 3       08:00:55           46.9           9141       3 WALK              1.8
##   wait distance route                       geometry
## 1  0.0     1419       LINESTRING (-71.88129 45.42...
## 2  2.9     7595     9 LINESTRING (-71.88504 45.41...
## 3  0.0      127       LINESTRING (-71.92938 45.37...</code></pre>
<p>La durée du trajet à 18 h au départ de l’Université de Sherbrooke est estimée à 57,6 minutes avec cinq segments dont trois à la marche et deux en bus.</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="sect052.html#cb417-1" tabindex="-1"></a>TC.Retour</span></code></pre></div>
<pre><code>## Simple feature collection with 5 features and 16 fields
## Geometry type: LINESTRING
## Dimension:     XY
## Bounding box:  xmin: -71.9331 ymin: 45.3776 xmax: -71.88195 ymax: 45.42204
## Geodetic CRS:  WGS 84
##            from_id from_lat  from_lon  to_id   to_lat    to_lon option
## 1 Campus principal 45.37802 -71.92953 Départ 45.42203 -71.88183      1
## 2 Campus principal 45.37802 -71.92953 Départ 45.42203 -71.88183      1
## 3 Campus principal 45.37802 -71.92953 Départ 45.42203 -71.88183      1
## 4 Campus principal 45.37802 -71.92953 Départ 45.42203 -71.88183      1
## 5 Campus principal 45.37802 -71.92953 Départ 45.42203 -71.88183      1
##   departure_time total_duration total_distance segment mode segment_duration
## 1       18:00:55           57.6          11482       1 WALK              1.9
## 2       18:00:55           57.6          11482       2  BUS             20.0
## 3       18:00:55           57.6          11482       3 WALK              0.8
## 4       18:00:55           57.6          11482       4  BUS             14.2
## 5       18:00:55           57.6          11482       5 WALK             12.3
##   wait distance route                       geometry
## 1  0.0      150       LINESTRING (-71.92953 45.37...
## 2  4.2     7649    14 LINESTRING (-71.92949 45.37...
## 3  0.0      107       LINESTRING (-71.8939 45.399...
## 4  4.2     2769     3 LINESTRING (-71.89436 45.39...
## 5  0.0      807       LINESTRING (-71.88207 45.41...</code></pre>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="sect052.html#cb419-1" tabindex="-1"></a>Carte1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(TC.Aller)<span class="sc">+</span><span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;mode&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, </span>
<span id="cb419-2"><a href="sect052.html#cb419-2" tabindex="-1"></a>                                      <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">&quot;mode&quot;</span>, <span class="st">&quot;from_id&quot;</span>, <span class="st">&quot;to_id&quot;</span>, </span>
<span id="cb419-3"><a href="sect052.html#cb419-3" tabindex="-1"></a>                                                     <span class="st">&quot;segment_duration&quot;</span>, <span class="st">&quot;distance&quot;</span>,</span>
<span id="cb419-4"><a href="sect052.html#cb419-4" tabindex="-1"></a>                                                     <span class="st">&quot;total_duration&quot;</span>, <span class="st">&quot;total_distance&quot;</span>))<span class="sc">+</span></span>
<span id="cb419-5"><a href="sect052.html#cb419-5" tabindex="-1"></a>  <span class="fu">tm_shape</span>(Point)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb419-6"><a href="sect052.html#cb419-6" tabindex="-1"></a>  <span class="fu">tm_shape</span>(UDeS)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)</span>
<span id="cb419-7"><a href="sect052.html#cb419-7" tabindex="-1"></a>Carte2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(TC.Retour)<span class="sc">+</span><span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">&quot;mode&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, </span>
<span id="cb419-8"><a href="sect052.html#cb419-8" tabindex="-1"></a>                                       <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">&quot;mode&quot;</span>, <span class="st">&quot;from_id&quot;</span>, <span class="st">&quot;to_id&quot;</span>, </span>
<span id="cb419-9"><a href="sect052.html#cb419-9" tabindex="-1"></a>                                                      <span class="st">&quot;segment_duration&quot;</span>, <span class="st">&quot;distance&quot;</span>,</span>
<span id="cb419-10"><a href="sect052.html#cb419-10" tabindex="-1"></a>                                                      <span class="st">&quot;total_duration&quot;</span>, <span class="st">&quot;total_distance&quot;</span>))<span class="sc">+</span></span>
<span id="cb419-11"><a href="sect052.html#cb419-11" tabindex="-1"></a>  <span class="fu">tm_shape</span>(Point)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb419-12"><a href="sect052.html#cb419-12" tabindex="-1"></a>  <span class="fu">tm_shape</span>(UDeS)<span class="sc">+</span><span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">size =</span> .<span class="dv">15</span>)</span>
<span id="cb419-13"><a href="sect052.html#cb419-13" tabindex="-1"></a><span class="fu">tmap_arrange</span>(Carte1, Carte2)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:TrajetsTC"></span>
<img src="images/Chap05/TrajetsTC.png" alt="Trajets en transport en commun" width="100%" />
<p class="caption">
Figure 5.11: Trajets en transport en commun
</p>
</div>
</div>
</div>
<div id="sect0524" class="section level3 hasAnchor" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Calcul de matrices OD selon différents modes de transport<a href="sect052.html#sect0524" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pour calculer des matrices origines-destinations selon différents modes de transport, nous utilisons la fonction <code>travel_time_matrix</code> dont les paramètres sont quasi les mêmes que la <code>detailed_itineraries</code> (section <a href="sect052.html#sect0523">5.2.3</a>). Dans le code ci-dessous, nous importons 284 adresses tirées aléatoirement et les supermarchés présents sur le territoire de la ville de Sherbrooke.</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="sect052.html#cb420-1" tabindex="-1"></a><span class="do">## Importation des couches</span></span>
<span id="cb420-2"><a href="sect052.html#cb420-2" tabindex="-1"></a>Adresses <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">&quot;data/Chap05/AutresDonnees/Commerces.gpkg&quot;</span>,</span>
<span id="cb420-3"><a href="sect052.html#cb420-3" tabindex="-1"></a>                        <span class="at">layer =</span> <span class="st">&quot;AdressesAleatoires&quot;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb420-4"><a href="sect052.html#cb420-4" tabindex="-1"></a>supermarches <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">&quot;data/Chap05/AutresDonnees/Commerces.gpkg&quot;</span>,</span>
<span id="cb420-5"><a href="sect052.html#cb420-5" tabindex="-1"></a>                        <span class="at">layer =</span> <span class="st">&quot;supermarche&quot;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb420-6"><a href="sect052.html#cb420-6" tabindex="-1"></a><span class="do">## Nombre de distances à calculer</span></span>
<span id="cb420-7"><a href="sect052.html#cb420-7" tabindex="-1"></a>nO <span class="ot">=</span> <span class="fu">nrow</span>(Adresses)</span>
<span id="cb420-8"><a href="sect052.html#cb420-8" tabindex="-1"></a>nD <span class="ot">=</span> <span class="fu">nrow</span>(supermarches)</span>
<span id="cb420-9"><a href="sect052.html#cb420-9" tabindex="-1"></a>NOD <span class="ot">=</span> nO <span class="sc">*</span> nD</span>
<span id="cb420-10"><a href="sect052.html#cb420-10" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Origines (O) :&quot;</span>, nO, <span class="st">&quot;adresses&quot;</span>,</span>
<span id="cb420-11"><a href="sect052.html#cb420-11" tabindex="-1"></a>    <span class="st">&quot;</span><span class="sc">\n</span><span class="st"> Destinations (D) :&quot;</span>, nD, <span class="st">&quot;supermarchés&quot;</span>,</span>
<span id="cb420-12"><a href="sect052.html#cb420-12" tabindex="-1"></a>    <span class="st">&quot;</span><span class="sc">\n</span><span class="st"> Distances OD à calculer = &quot;</span>, NOD)</span></code></pre></div>
<pre><code>## Origines (O) : 184 adresses 
##  Destinations (D) : 27 supermarchés 
##  Distances OD à calculer =  4968</code></pre>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="sect052.html#cb422-1" tabindex="-1"></a><span class="do">## Origines et destinations</span></span>
<span id="cb422-2"><a href="sect052.html#cb422-2" tabindex="-1"></a>Origines <span class="ot">&lt;-</span> Adresses</span>
<span id="cb422-3"><a href="sect052.html#cb422-3" tabindex="-1"></a>Origines<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">as.character</span>(Adresses<span class="sc">$</span>id)</span>
<span id="cb422-4"><a href="sect052.html#cb422-4" tabindex="-1"></a>Origines<span class="sc">$</span>lat <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(Adresses)[,<span class="dv">2</span>]</span>
<span id="cb422-5"><a href="sect052.html#cb422-5" tabindex="-1"></a>Origines<span class="sc">$</span>lon <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(Adresses)[,<span class="dv">1</span>]</span>
<span id="cb422-6"><a href="sect052.html#cb422-6" tabindex="-1"></a>Destinations <span class="ot">&lt;-</span> supermarches</span>
<span id="cb422-7"><a href="sect052.html#cb422-7" tabindex="-1"></a>Destinations<span class="sc">$</span>id <span class="ot">&lt;-</span> supermarches<span class="sc">$</span>osm_id</span>
<span id="cb422-8"><a href="sect052.html#cb422-8" tabindex="-1"></a>Destinations<span class="sc">$</span>lat <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(supermarches)[,<span class="dv">2</span>]</span>
<span id="cb422-9"><a href="sect052.html#cb422-9" tabindex="-1"></a>Destinations<span class="sc">$</span>lon <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(supermarches)[,<span class="dv">1</span>]</span>
<span id="cb422-10"><a href="sect052.html#cb422-10" tabindex="-1"></a><span class="fu">names</span>(Destinations)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;id&quot;</span></span></code></pre></div>
<p>Par la suite, nous calculons les différentes matrices OD :</p>
<ul>
<li><strong><code>matriceOD.Auto</code></strong> avec <code>mode = "CAR"</code>.</li>
<li><strong><code>matriceOD.Marche</code></strong> avec <code>mode = "WALK"</code>, <code>walk_speed = 4.5</code> et <code>max_trip_duration = 60</code>. La durée du trajet est limitée à 60 minutes avec une vitesse moyenne de 4,5 km/h.</li>
<li><strong><code>matriceOD.Velo</code></strong> avec <code>mode = "BICYCLE"</code>, <code>bike_speed = 15</code> et <code>max_trip_duration = 60</code>. La durée du trajet est limitée à 60 minutes avec une vitesse moyenne de 15 km/h.</li>
<li><strong><code>matriceOD.Auto</code></strong> avec <code>mode = "c("WALK", "TRANSIT")"</code>, <code>walk_speed = 4.5</code>, <code>max_walk_time = 30</code>, <code>max_trip_duration = 120</code> et <code>departure_datetime = dateheure.soir</code>. La durée du trajet est limitée à 60 minutes avec une vitesse moyenne de marche de 4,5 km/h et une durée maximale de 30 minutes pour chaque segment à la marche. L’heure de départ a été fixée comme suit : <code>dateheure.soir  &lt;- as.POSIXct("04-05-2023 18:00:00", format = "%d-%m-%Y %H:%M:%S")</code>.</li>
</ul>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="sect052.html#cb423-1" tabindex="-1"></a><span class="do">## Matrice OD en voiture</span></span>
<span id="cb423-2"><a href="sect052.html#cb423-2" tabindex="-1"></a>t1 <span class="ot">&lt;-</span><span class="fu">Sys.time</span>()</span>
<span id="cb423-3"><a href="sect052.html#cb423-3" tabindex="-1"></a>matriceOD.Auto <span class="ot">&lt;-</span> <span class="fu">travel_time_matrix</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb423-4"><a href="sect052.html#cb423-4" tabindex="-1"></a>                                     <span class="at">origins =</span> Origines,</span>
<span id="cb423-5"><a href="sect052.html#cb423-5" tabindex="-1"></a>                                     <span class="at">destinations =</span> Destinations,</span>
<span id="cb423-6"><a href="sect052.html#cb423-6" tabindex="-1"></a>                                     <span class="at">mode =</span> <span class="st">&quot;CAR&quot;</span>)</span>
<span id="cb423-7"><a href="sect052.html#cb423-7" tabindex="-1"></a>t2 <span class="ot">&lt;-</span><span class="fu">Sys.time</span>()</span>
<span id="cb423-8"><a href="sect052.html#cb423-8" tabindex="-1"></a>duree.auto <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(t2, t1), <span class="at">units =</span> <span class="st">&quot;secs&quot;</span>)</span>
<span id="cb423-9"><a href="sect052.html#cb423-9" tabindex="-1"></a><span class="do">## Matrice OD à la marche</span></span>
<span id="cb423-10"><a href="sect052.html#cb423-10" tabindex="-1"></a>t1 <span class="ot">&lt;-</span><span class="fu">Sys.time</span>()</span>
<span id="cb423-11"><a href="sect052.html#cb423-11" tabindex="-1"></a>matriceOD.Marche <span class="ot">&lt;-</span> <span class="fu">travel_time_matrix</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb423-12"><a href="sect052.html#cb423-12" tabindex="-1"></a>                                       <span class="at">origins =</span> Origines,</span>
<span id="cb423-13"><a href="sect052.html#cb423-13" tabindex="-1"></a>                                       <span class="at">destinations =</span> Destinations,</span>
<span id="cb423-14"><a href="sect052.html#cb423-14" tabindex="-1"></a>                                       <span class="at">mode =</span> <span class="st">&quot;WALK&quot;</span>,</span>
<span id="cb423-15"><a href="sect052.html#cb423-15" tabindex="-1"></a>                                       <span class="at">walk_speed =</span> <span class="fl">4.5</span>,  <span class="co"># valeur par défaut 3.6</span></span>
<span id="cb423-16"><a href="sect052.html#cb423-16" tabindex="-1"></a>                                       <span class="at">max_trip_duration =</span> <span class="dv">60</span>, <span class="co"># 1 heure de marche maximum</span></span>
<span id="cb423-17"><a href="sect052.html#cb423-17" tabindex="-1"></a>                                       <span class="at">max_walk_time =</span> <span class="cn">Inf</span>)</span>
<span id="cb423-18"><a href="sect052.html#cb423-18" tabindex="-1"></a>t2 <span class="ot">&lt;-</span><span class="fu">Sys.time</span>()</span>
<span id="cb423-19"><a href="sect052.html#cb423-19" tabindex="-1"></a>duree.marche <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(t2, t1), <span class="at">units =</span> <span class="st">&quot;secs&quot;</span>)</span>
<span id="cb423-20"><a href="sect052.html#cb423-20" tabindex="-1"></a><span class="do">## Matrice OD en vélo</span></span>
<span id="cb423-21"><a href="sect052.html#cb423-21" tabindex="-1"></a>t1 <span class="ot">&lt;-</span><span class="fu">Sys.time</span>()</span>
<span id="cb423-22"><a href="sect052.html#cb423-22" tabindex="-1"></a>matriceOD.Velo <span class="ot">&lt;-</span> <span class="fu">travel_time_matrix</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb423-23"><a href="sect052.html#cb423-23" tabindex="-1"></a>                                     <span class="at">origins =</span> Origines,</span>
<span id="cb423-24"><a href="sect052.html#cb423-24" tabindex="-1"></a>                                     <span class="at">destinations =</span> Destinations,</span>
<span id="cb423-25"><a href="sect052.html#cb423-25" tabindex="-1"></a>                                     <span class="at">mode =</span> <span class="st">&quot;BICYCLE&quot;</span>,</span>
<span id="cb423-26"><a href="sect052.html#cb423-26" tabindex="-1"></a>                                     <span class="at">bike_speed =</span> <span class="dv">15</span>,</span>
<span id="cb423-27"><a href="sect052.html#cb423-27" tabindex="-1"></a>                                     <span class="at">max_trip_duration =</span> <span class="dv">60</span>,</span>
<span id="cb423-28"><a href="sect052.html#cb423-28" tabindex="-1"></a>                                     <span class="at">max_bike_time =</span> <span class="cn">Inf</span>)</span>
<span id="cb423-29"><a href="sect052.html#cb423-29" tabindex="-1"></a>t2 <span class="ot">&lt;-</span><span class="fu">Sys.time</span>()</span>
<span id="cb423-30"><a href="sect052.html#cb423-30" tabindex="-1"></a>duree.velo <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(t2, t1), <span class="at">units =</span> <span class="st">&quot;secs&quot;</span>)</span>
<span id="cb423-31"><a href="sect052.html#cb423-31" tabindex="-1"></a><span class="do">## Matrice OD en transport en commun</span></span>
<span id="cb423-32"><a href="sect052.html#cb423-32" tabindex="-1"></a>dateheure.soir  <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;04-05-2023 18:00:00&quot;</span>,</span>
<span id="cb423-33"><a href="sect052.html#cb423-33" tabindex="-1"></a>                              <span class="at">format =</span> <span class="st">&quot;%d-%m-%Y %H:%M:%S&quot;</span>)</span>
<span id="cb423-34"><a href="sect052.html#cb423-34" tabindex="-1"></a>t1 <span class="ot">&lt;-</span><span class="fu">Sys.time</span>()</span>
<span id="cb423-35"><a href="sect052.html#cb423-35" tabindex="-1"></a>matriceOD.TC <span class="ot">&lt;-</span> <span class="fu">travel_time_matrix</span>(<span class="at">r5r_core =</span> r5r_core,</span>
<span id="cb423-36"><a href="sect052.html#cb423-36" tabindex="-1"></a>                                   <span class="at">origins =</span> Origines,</span>
<span id="cb423-37"><a href="sect052.html#cb423-37" tabindex="-1"></a>                                   <span class="at">destinations =</span> Destinations,</span>
<span id="cb423-38"><a href="sect052.html#cb423-38" tabindex="-1"></a>                                   <span class="at">mode =</span> <span class="fu">c</span>(<span class="st">&quot;WALK&quot;</span>, <span class="st">&quot;TRANSIT&quot;</span>),</span>
<span id="cb423-39"><a href="sect052.html#cb423-39" tabindex="-1"></a>                                   <span class="at">walk_speed =</span> <span class="fl">4.5</span>,</span>
<span id="cb423-40"><a href="sect052.html#cb423-40" tabindex="-1"></a>                                   <span class="at">max_walk_time =</span> <span class="dv">30</span>,</span>
<span id="cb423-41"><a href="sect052.html#cb423-41" tabindex="-1"></a>                                   <span class="at">max_trip_duration =</span> <span class="dv">120</span>,</span>
<span id="cb423-42"><a href="sect052.html#cb423-42" tabindex="-1"></a>                                   <span class="at">departure_datetime =</span> dateheure.soir)</span>
<span id="cb423-43"><a href="sect052.html#cb423-43" tabindex="-1"></a>t2 <span class="ot">&lt;-</span><span class="fu">Sys.time</span>()</span>
<span id="cb423-44"><a href="sect052.html#cb423-44" tabindex="-1"></a>duree.tc <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(t2, t1), <span class="at">units =</span> <span class="st">&quot;secs&quot;</span>)</span></code></pre></div>
<p>Les temps de calcul des différentes matrices sont reportés ci-dessous.</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="sect052.html#cb424-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Temps de calcul des matrices :&quot;</span>, </span>
<span id="cb424-2"><a href="sect052.html#cb424-2" tabindex="-1"></a>     <span class="st">&quot;</span><span class="sc">\n</span><span class="st"> Voiture : &quot;</span>, <span class="fu">round</span>(duree.auto,<span class="dv">2</span>), <span class="st">&quot;secondes&quot;</span>,</span>
<span id="cb424-3"><a href="sect052.html#cb424-3" tabindex="-1"></a>     <span class="st">&quot;</span><span class="sc">\n</span><span class="st"> Marche : &quot;</span>, <span class="fu">round</span>(duree.marche,<span class="dv">2</span>), <span class="st">&quot;secondes&quot;</span>,</span>
<span id="cb424-4"><a href="sect052.html#cb424-4" tabindex="-1"></a>     <span class="st">&quot;</span><span class="sc">\n</span><span class="st"> Vélo : &quot;</span>, <span class="fu">round</span>(duree.velo,<span class="dv">2</span>), <span class="st">&quot;secondes&quot;</span>,</span>
<span id="cb424-5"><a href="sect052.html#cb424-5" tabindex="-1"></a>     <span class="st">&quot;</span><span class="sc">\n</span><span class="st"> Transport en commun : &quot;</span>, <span class="fu">round</span>(duree.tc,<span class="dv">2</span>), <span class="st">&quot;secondes&quot;</span>)</span></code></pre></div>
<pre><code>## Temps de calcul des matrices : 
##  Voiture :  13.17 secondes 
##  Marche :  0.52 secondes 
##  Vélo :  3.83 secondes 
##  Transport en commun :  0.43 secondes</code></pre>
<p>Une fois les matrices obtenues, nous les enregistrons dans un fichier <code>Rdata</code>.</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="sect052.html#cb426-1" tabindex="-1"></a><span class="fu">save</span>(matriceOD.Auto, matriceOD.Marche, </span>
<span id="cb426-2"><a href="sect052.html#cb426-2" tabindex="-1"></a>     matriceOD.Velo, matriceOD.TC,</span>
<span id="cb426-3"><a href="sect052.html#cb426-3" tabindex="-1"></a>     <span class="at">file=</span><span class="st">&quot;data/chap05/Resultats/MatricesOD.Rdata&quot;</span>)</span></code></pre></div>
<div class="bloc_attention">
<p><strong>Libération de la mémoire allouée à JAVA</strong></p>
<p>Une fois les calculs avec <code>R5R</code> terminés, il convient de détruire l’objet <code>r5r_core</code> et d’arrêter le processus JAVA avec les deux lignes de code ci-dessous.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="sect052.html#cb427-1" tabindex="-1"></a>r5r<span class="sc">::</span><span class="fu">stop_r5</span>(r5r_core)</span>
<span id="cb427-2"><a href="sect052.html#cb427-2" tabindex="-1"></a>rJava<span class="sc">::</span><span class="fu">.jgc</span>(<span class="at">R.gc =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<p>À partir de ces matrices, nous extrayons la valeur minimale pour chacune des adresses pour les quatre modes de transport. Puis, nous opérons une jointure attributaire avec la couche des adresses aléatoires avec la fonction <code>merge</code>.</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="sect052.html#cb428-1" tabindex="-1"></a><span class="do">## Création d&#39;un vecteur pour la distance au supermarché le plus proche </span></span>
<span id="cb428-2"><a href="sect052.html#cb428-2" tabindex="-1"></a>SupermarchePlusProche.Auto <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(travel_time_p50 <span class="sc">~</span> from_id, matriceOD.Auto, min)</span>
<span id="cb428-3"><a href="sect052.html#cb428-3" tabindex="-1"></a>SupermarchePlusProche.Pied <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(travel_time_p50 <span class="sc">~</span> from_id, matriceOD.Marche, min)</span>
<span id="cb428-4"><a href="sect052.html#cb428-4" tabindex="-1"></a>SupermarchePlusProche.Velo <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(travel_time_p50 <span class="sc">~</span> from_id, matriceOD.Velo, min)</span>
<span id="cb428-5"><a href="sect052.html#cb428-5" tabindex="-1"></a>SupermarchePlusProche.tc   <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(travel_time_p50 <span class="sc">~</span> from_id, matriceOD.TC, min)</span>
<span id="cb428-6"><a href="sect052.html#cb428-6" tabindex="-1"></a><span class="do">## Changement des noms des champs</span></span>
<span id="cb428-7"><a href="sect052.html#cb428-7" tabindex="-1"></a><span class="fu">names</span>(SupermarchePlusProche.Auto) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;SupPlusProcheAuto&quot;</span>)</span>
<span id="cb428-8"><a href="sect052.html#cb428-8" tabindex="-1"></a><span class="fu">names</span>(SupermarchePlusProche.Pied) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;SupPlusProchePied&quot;</span>)</span>
<span id="cb428-9"><a href="sect052.html#cb428-9" tabindex="-1"></a><span class="fu">names</span>(SupermarchePlusProche.Velo) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;SupPlusProcheVelo&quot;</span>)</span>
<span id="cb428-10"><a href="sect052.html#cb428-10" tabindex="-1"></a><span class="fu">names</span>(SupermarchePlusProche.tc)   <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;SupPlusProcheTC&quot;</span>)</span>
<span id="cb428-11"><a href="sect052.html#cb428-11" tabindex="-1"></a><span class="do">## Jointure avec la couche des adresses</span></span>
<span id="cb428-12"><a href="sect052.html#cb428-12" tabindex="-1"></a>Adresses <span class="ot">&lt;-</span> <span class="fu">merge</span>(Adresses, SupermarchePlusProche.Auto, <span class="at">by =</span><span class="st">&quot;id&quot;</span>, <span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb428-13"><a href="sect052.html#cb428-13" tabindex="-1"></a>Adresses <span class="ot">&lt;-</span> <span class="fu">merge</span>(Adresses, SupermarchePlusProche.Pied, <span class="at">by =</span><span class="st">&quot;id&quot;</span>, <span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb428-14"><a href="sect052.html#cb428-14" tabindex="-1"></a>Adresses <span class="ot">&lt;-</span> <span class="fu">merge</span>(Adresses, SupermarchePlusProche.Velo, <span class="at">by =</span><span class="st">&quot;id&quot;</span>, <span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb428-15"><a href="sect052.html#cb428-15" tabindex="-1"></a>Adresses <span class="ot">&lt;-</span> <span class="fu">merge</span>(Adresses, SupermarchePlusProche.tc, <span class="at">by =</span><span class="st">&quot;id&quot;</span>, <span class="at">all.x=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Finalement, nous utilisons le <em>package</em> <code>tmap</code> pour cartographier les résultats et réaliser une figure avec la fonction <code>tmap_arrange</code>.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="sect052.html#cb429-1" tabindex="-1"></a><span class="do">## Importation des arrondissements de la ville de Sherbrooke</span></span>
<span id="cb429-2"><a href="sect052.html#cb429-2" tabindex="-1"></a>arrondissements <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">&quot;data/Chap05/AutresDonnees/Arrondissements.shp&quot;</span>, </span>
<span id="cb429-3"><a href="sect052.html#cb429-3" tabindex="-1"></a>                           <span class="at">quiet=</span><span class="cn">TRUE</span>)</span>
<span id="cb429-4"><a href="sect052.html#cb429-4" tabindex="-1"></a><span class="do">## Construction des cartes</span></span>
<span id="cb429-5"><a href="sect052.html#cb429-5" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;plot&quot;</span>)</span>
<span id="cb429-6"><a href="sect052.html#cb429-6" tabindex="-1"></a>max.auto <span class="ot">&lt;-</span> <span class="fu">max</span>(Adresses<span class="sc">$</span>SupPlusProcheAuto,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb429-7"><a href="sect052.html#cb429-7" tabindex="-1"></a>Carte1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(arrondissements)<span class="sc">+</span><span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb429-8"><a href="sect052.html#cb429-8" tabindex="-1"></a>          <span class="fu">tm_shape</span>(Adresses)<span class="sc">+</span></span>
<span id="cb429-9"><a href="sect052.html#cb429-9" tabindex="-1"></a>            <span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;SupPlusProcheAuto&quot;</span>, </span>
<span id="cb429-10"><a href="sect052.html#cb429-10" tabindex="-1"></a>                    <span class="at">border.lwd =</span> <span class="dv">1</span>,</span>
<span id="cb429-11"><a href="sect052.html#cb429-11" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">&quot;fixed&quot;</span>,</span>
<span id="cb429-12"><a href="sect052.html#cb429-12" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,max.auto),</span>
<span id="cb429-13"><a href="sect052.html#cb429-13" tabindex="-1"></a>                    <span class="at">palette=</span><span class="st">&quot;YlOrRd&quot;</span>,</span>
<span id="cb429-14"><a href="sect052.html#cb429-14" tabindex="-1"></a>                    <span class="at">size =</span> .<span class="dv">2</span>, </span>
<span id="cb429-15"><a href="sect052.html#cb429-15" tabindex="-1"></a>                    <span class="at">title=</span><span class="st">&quot;Voiture&quot;</span>)<span class="sc">+</span></span>
<span id="cb429-16"><a href="sect052.html#cb429-16" tabindex="-1"></a>          <span class="fu">tm_shape</span>(arrondissements)<span class="sc">+</span><span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb429-17"><a href="sect052.html#cb429-17" tabindex="-1"></a>          <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span>
<span id="cb429-18"><a href="sect052.html#cb429-18" tabindex="-1"></a></span>
<span id="cb429-19"><a href="sect052.html#cb429-19" tabindex="-1"></a>max.pied <span class="ot">&lt;-</span> <span class="fu">max</span>(Adresses<span class="sc">$</span>SupPlusProchePied,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb429-20"><a href="sect052.html#cb429-20" tabindex="-1"></a>Carte2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(arrondissements)<span class="sc">+</span><span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb429-21"><a href="sect052.html#cb429-21" tabindex="-1"></a>          <span class="fu">tm_shape</span>(Adresses)<span class="sc">+</span></span>
<span id="cb429-22"><a href="sect052.html#cb429-22" tabindex="-1"></a>            <span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;SupPlusProchePied&quot;</span>, </span>
<span id="cb429-23"><a href="sect052.html#cb429-23" tabindex="-1"></a>                    <span class="at">border.lwd =</span> <span class="dv">1</span>,</span>
<span id="cb429-24"><a href="sect052.html#cb429-24" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">&quot;fixed&quot;</span>,</span>
<span id="cb429-25"><a href="sect052.html#cb429-25" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,max.pied),</span>
<span id="cb429-26"><a href="sect052.html#cb429-26" tabindex="-1"></a>                    <span class="at">palette=</span><span class="st">&quot;YlOrRd&quot;</span>,</span>
<span id="cb429-27"><a href="sect052.html#cb429-27" tabindex="-1"></a>                    <span class="at">size =</span> .<span class="dv">2</span>, </span>
<span id="cb429-28"><a href="sect052.html#cb429-28" tabindex="-1"></a>                    <span class="at">title=</span><span class="st">&quot;Marche&quot;</span>,</span>
<span id="cb429-29"><a href="sect052.html#cb429-29" tabindex="-1"></a>                    <span class="at">textNA =</span> <span class="st">&quot;Plus de 60&quot;</span>)<span class="sc">+</span></span>
<span id="cb429-30"><a href="sect052.html#cb429-30" tabindex="-1"></a>          <span class="fu">tm_shape</span>(arrondissements)<span class="sc">+</span><span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb429-31"><a href="sect052.html#cb429-31" tabindex="-1"></a>          <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span>
<span id="cb429-32"><a href="sect052.html#cb429-32" tabindex="-1"></a></span>
<span id="cb429-33"><a href="sect052.html#cb429-33" tabindex="-1"></a>max.velo <span class="ot">&lt;-</span> <span class="fu">max</span>(Adresses<span class="sc">$</span>SupPlusProcheVelo,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb429-34"><a href="sect052.html#cb429-34" tabindex="-1"></a>Carte3 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(arrondissements)<span class="sc">+</span><span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb429-35"><a href="sect052.html#cb429-35" tabindex="-1"></a>          <span class="fu">tm_shape</span>(Adresses)<span class="sc">+</span></span>
<span id="cb429-36"><a href="sect052.html#cb429-36" tabindex="-1"></a>            <span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;SupPlusProcheVelo&quot;</span>, </span>
<span id="cb429-37"><a href="sect052.html#cb429-37" tabindex="-1"></a>                    <span class="at">border.lwd =</span> <span class="dv">1</span>,</span>
<span id="cb429-38"><a href="sect052.html#cb429-38" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">&quot;fixed&quot;</span>,</span>
<span id="cb429-39"><a href="sect052.html#cb429-39" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,max.velo),</span>
<span id="cb429-40"><a href="sect052.html#cb429-40" tabindex="-1"></a>                    <span class="at">palette=</span><span class="st">&quot;YlOrRd&quot;</span>,</span>
<span id="cb429-41"><a href="sect052.html#cb429-41" tabindex="-1"></a>                    <span class="at">size =</span> .<span class="dv">2</span>, </span>
<span id="cb429-42"><a href="sect052.html#cb429-42" tabindex="-1"></a>                    <span class="at">title=</span><span class="st">&quot;Vélo&quot;</span>,</span>
<span id="cb429-43"><a href="sect052.html#cb429-43" tabindex="-1"></a>                    <span class="at">textNA =</span> <span class="st">&quot;Plus de 60&quot;</span>)<span class="sc">+</span></span>
<span id="cb429-44"><a href="sect052.html#cb429-44" tabindex="-1"></a>          <span class="fu">tm_shape</span>(arrondissements)<span class="sc">+</span><span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb429-45"><a href="sect052.html#cb429-45" tabindex="-1"></a>          <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span>
<span id="cb429-46"><a href="sect052.html#cb429-46" tabindex="-1"></a></span>
<span id="cb429-47"><a href="sect052.html#cb429-47" tabindex="-1"></a>max.tc <span class="ot">&lt;-</span> <span class="fu">max</span>(Adresses<span class="sc">$</span>SupPlusProcheTC,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb429-48"><a href="sect052.html#cb429-48" tabindex="-1"></a>Carte4 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(arrondissements)<span class="sc">+</span><span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb429-49"><a href="sect052.html#cb429-49" tabindex="-1"></a>          <span class="fu">tm_shape</span>(Adresses)<span class="sc">+</span></span>
<span id="cb429-50"><a href="sect052.html#cb429-50" tabindex="-1"></a>            <span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">&quot;SupPlusProcheTC&quot;</span>, </span>
<span id="cb429-51"><a href="sect052.html#cb429-51" tabindex="-1"></a>                    <span class="at">border.lwd =</span> <span class="dv">1</span>,</span>
<span id="cb429-52"><a href="sect052.html#cb429-52" tabindex="-1"></a>                    <span class="at">style =</span> <span class="st">&quot;fixed&quot;</span>,</span>
<span id="cb429-53"><a href="sect052.html#cb429-53" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,max.tc),</span>
<span id="cb429-54"><a href="sect052.html#cb429-54" tabindex="-1"></a>                    <span class="at">palette=</span><span class="st">&quot;YlOrRd&quot;</span>,</span>
<span id="cb429-55"><a href="sect052.html#cb429-55" tabindex="-1"></a>                    <span class="at">size =</span> .<span class="dv">2</span>, </span>
<span id="cb429-56"><a href="sect052.html#cb429-56" tabindex="-1"></a>                    <span class="at">title=</span><span class="st">&quot;Bus&quot;</span>,</span>
<span id="cb429-57"><a href="sect052.html#cb429-57" tabindex="-1"></a>                    <span class="at">textNA =</span> <span class="st">&quot;Plus de 60&quot;</span>)<span class="sc">+</span></span>
<span id="cb429-58"><a href="sect052.html#cb429-58" tabindex="-1"></a>          <span class="fu">tm_shape</span>(arrondissements)<span class="sc">+</span><span class="fu">tm_borders</span>(<span class="at">lwd =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb429-59"><a href="sect052.html#cb429-59" tabindex="-1"></a>          <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span>
<span id="cb429-60"><a href="sect052.html#cb429-60" tabindex="-1"></a></span>
<span id="cb429-61"><a href="sect052.html#cb429-61" tabindex="-1"></a><span class="do">## Figure avec les quatre cartes</span></span>
<span id="cb429-62"><a href="sect052.html#cb429-62" tabindex="-1"></a><span class="fu">tmap_arrange</span>(Carte1,Carte2, Carte3, Carte4)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:CartoAdressesSupPlusProche"></span>
<img src="GMQ405_files/figure-html/CartoAdressesSupPlusProche-1.png" alt="Supermarché le plus proche en minutes selon le mode de transport" width="100%" />
<p class="caption">
Figure 5.12: Supermarché le plus proche en minutes selon le mode de transport
</p>
</div>
</div>
</div>
<h3>Références</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-osmextractpackage" class="csl-entry">
Gilardi, Andrea et Robin Lovelace. 2022. <em>osmextract: Download and Import Open Street Map Data Extracts</em>. s.n. <a href="https://CRAN.R-project.org/package=osmextract">https://CRAN.R-project.org/package=osmextract</a>.
</div>
<div id="ref-packageOpenTripPlanner" class="csl-entry">
Morgan, Malcolm, Young Marcus, Robin Lovelace et Layik Hama. 2019. <span>« OpenTripPlanner for R. »</span> <em>Journal of Open Source Software</em> 4 (44): 1926. <a href="https://10.21105/joss.01926">https://10.21105/joss.01926</a>.
</div>
<div id="ref-packageR5R" class="csl-entry">
Pereira, Rafael H. M., Marcus Saraiva, DanielHerszenhut, Carlos Kaue Vieira Braga et Matthew Wigginton Conway. 2021. <span>« r5r: Rapid Realistic Routing on Multimodal Transport Networks with R5 in R. »</span> <em>Findings</em>. <a href="https://doi.org/10.32866/001c.21262">https://doi.org/10.32866/001c.21262</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sect051.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sect053.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["GMQ405.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
